(this.$WP=this.$WP||[]).push(["b5kt6r",(e,a)=>{var t,r,n,i,s,o,l,d,c,u,h,m,g,p,f,T,v,b,E,I,y,C,N,_,S,M,R,k,P,A,w,O,L,D,B,Q,z,x,W,H,V,K,q,G,Y,j,F,U,Z,X,$,J,ee,ea,et,er,en,ei,es,eo,el,ed,ec,eu,eh,em,eg,ep,ef,eT,ev,eb,eE,eI,ey,eC,eN,e_,eS,eM,eR,ek,eP,eA,ew,eO,eL,eD,eB,eQ,ez,ex,eW,eH,eV,eK,eq,eG,eY,ej,eF,eU,eZ,eX,e$,eJ,e0,e1,e2,e4,e3,e6,e9,e7,e5,e8,ae,aa,at,ar,an,ai,as,ao,al,ad,ac,au,ah,am,ag,ap,af,aT,av,ab,aE,aI,ay,aC,aN,a_,aS,aM,aR,ak,aP,aA,aw,aO,aL,aD,aB,aQ,az,ax,aW,aH,aV,aK,aq,aG,aY,aj,aF,aU,aZ,aX={toast:"sraSA _Q _U l Za",toastWrapper:"DSDjH"},a$=e=>{switch(e){case"error":return Q;case"success":return B;case"thumbsDown":return z;case"thumbsUp":return x}},aJ=({children:e})=>{var[a,n]=i(null),l=!!a?.textContent;s(()=>{var e;return l&&(e=setTimeout(()=>n(null),a?.isDurationLong?6e3:3500)),()=>clearTimeout(e)},[l,a]);var d=o(()=>({openToast:e=>{n(e)}}),[]);return t(at.Provider,{value:d,children:[e,a?r("div",{className:aX.toast,role:"alert",children:r("div",{className:aX.toastWrapper,children:r(W,{variant:a.variant,textContent:a.textContent,icon:a$(a.icon)})})}):null]})},a0=()=>{var e=d(at);if(!e)throw Error("Please use the hook inside the ChatPanelsToastContext context provider");return e},a1={__key:28710699928632,id:"1a1cbb120c38cd2e",loc:{},definitions:[]},a2={__key:96006977412143,id:"57515dc8dc2fede0",loc:{},definitions:[]},a4={__key:0xb78424f169b1,id:"b78424f169b142df",loc:{},definitions:[]},a3={__key:0x8786e16fbe96,id:"8786e16fbe962d09",loc:{},definitions:[]},a6={__key:26039558715119,id:"17aecea5b6efc6dc",loc:{},definitions:[]},a9={__key:2514373530611,id:"02496c5753f34af4",loc:{},definitions:[]},a7=e=>{var a=v.useConstantIncrementCallback(1),t=v.useIncrementCallback(as,b.M);return c(e=>{var r=0,n=!1;e.forEach(e=>{e?.content?.forEach(e=>{e?.__typename==="TravelChatManager_LocationList"&&(r+=e.locations.length),e?.__typename==="TravelChatManager_Text"&&e?.link?.anchorText&&(n=!0)})}),r>0?(t(r),a(as,b.LOCATIONSELECTION),a(as,b.TAG),a(as,b.LK),a(as,b.LOCALIZATION)):n&&a(as,b.LOCALIZATION)},[a,t,e])},a5=({threadId:e,messageId:a,limit:t,mostRecentFirst:r=!1},n=!1)=>{var i=D()||"",l=ee(),d=o(()=>({userId:i,threadId:e,messageId:a,limit:t,currency:l,tagCategories:ai}),[i,e,a,t,l]),[{data:c,fetching:u,error:h},m]=X({query:a6,variables:d,pause:n,requestPolicy:"network-only"}),g=a7("useMessages");return s(()=>{var e=c?.TravelChatManager_getMessages?.messages;!u&&!n&&e?.length&&g(e.map(e=>e?.__typename==="TravelChatManager_AssistantMessage"?e:null).filter(Boolean))},[c,u,d,n,g]),[{data:o(()=>{if(c){var e=c.TravelChatManager_getMessages?.messages||null;return{messages:!e||r?e:[...e].reverse(),nextMessageId:c?.TravelChatManager_getMessages?.nextMessageId||null}}},[c,r]),fetching:u,error:h},m]},a8=()=>{var e=D()||"",{languageTag:a,geoId:t,locationId:r,pageName:n,currency:i}=T(),[{fetching:s},o]=$(a2),l=a7("useSendMessage");return{sendMessage:c(({threadId:s,text:d,response:c,userId:u})=>o({userId:u??e,threadId:s,responseContent:c,text:d,geoId:t,languageTag:a,locationId:r,pageName:n,localTime:new Date().toISOString(),currency:i,tagCategories:ai}).then(e=>{var a=e.data?.TravelChatManager_addMessage?.reply;return l(a?[a]:[]),e}),[o,e,t,a,r,n,i,l]),fetching:s}},te=()=>{var e=D()||"",a=ee(),[{fetching:t,error:r},n]=$(a4);return{cancelPendingMessage:c(({threadId:t,messageId:r})=>n({userId:e,threadId:t,messageId:r,currency:a,tagCategories:ai}),[n,e,a]),fetching:t,error:r}},ta=()=>{var e=D()||"",[{fetching:a},t]=$(a1);return{addFeedback:c(({threadId:a,messageId:r,rating:n,customFeedback:i})=>t({userId:e,threadId:a,messageId:r,rating:n,customFeedback:i}),[t,e]),fetching:a}},tt=({threadId:e,limit:a},t=!1)=>{var r=D()||"",n=o(()=>({userId:r,threadId:e,limit:a}),[r,e,a]);return X({query:a9,variables:n,pause:t,requestPolicy:"network-only"})},tr=()=>{var e=D()||"",[a,t]=$(a3);return{deleteThreads:c(a=>t({userId:e,threadId:a}),[t,e]),state:a}},tn=e=>{for(var a=e.slice(),t=a.length-1;t>0;t--){var r=Math.floor(Math.random()*(t+1));[a[t],a[r]]=[a[r],a[t]]}return a},ti={optionsContainer:"oNVYt Rd Gi",optionsHeader:"zVilR f MI",optionsHeaderContent:"P",thumbsContainer:"NM Nk",freeFormContainer:"yJRrg",freeFormSubmitContainer:"gOmiR f",votingThumbsContainer:"XlDrI f",votedThumbsContainer:"edJMz Ci"},ts=({disabled:e,onSubmit:a})=>{var[n,o]=i(""),l=u(null),d=u(null);return s(()=>{d.current?.scrollIntoView({behavior:"smooth",block:"end"}),l.current?.focus()},[]),t("form",{ref:d,onSubmit:e=>{e.preventDefault(),a(n.trim())},children:[r(ec,{value:n,onChange:e=>o(e.target.value),"aria-label":an.feedback.inputAriaLabel,placeholder:an.feedback.feedbackPlaceholder,maxLength:160,ref:l}),r("div",{className:ti.freeFormSubmitContainer,children:r(q,{type:"submit",disabled:e,variant:"primary",children:an.feedback.submitButton})})]})},to=({feedbackRating:e,disabled:a,onSelect:n,onClose:i})=>{var l=u(null);s(()=>{l.current?.scrollIntoView({behavior:"smooth",block:"nearest"})},[]);var d=e=>{n({isFlowComplete:"OTHER"!==e,rating:e})},c="OTHER"===e,h=[...o(()=>tn(Object.entries(ao).slice(0,4)),[]),...Object.entries(ao).slice(4)];return t("div",{className:ti.optionsContainer,ref:l,children:[t("div",{className:ti.optionsHeader,children:[r("div",{id:"feedbackOptionsLabel",className:ti.optionsHeaderContent,children:r(j,{atlasVariant:"fixed-label-30",children:an.feedback.thumbsDownTitle})}),r(G,{type:"button",variant:"clear",size:"small",icon:eo,onClick:i,"aria-label":an.feedback.closeAriaLabel})]}),r(el,{name:"feedbackOptions",ariaLabelledBy:"feedbackOptionsLabel",children:h.map(([t,n])=>r("div",{children:r(ed,{value:t,selected:e===t,onSelect:()=>d(t),label:n,disabled:a,alignItems:"center"},t)},t))}),c&&r("div",{className:ti.freeFormContainer,children:r(ts,{onSubmit:a=>{c&&n({isFlowComplete:!0,rating:e,message:a.trim()})},disabled:a})})]})},tl=({disabled:e,onThumbsUp:a,onThumbsDown:n,feedbackRating:i})=>i?r("div",{className:ti.votedThumbsContainer,children:"GOOD"===i?r(es,{size:20,ariaAttributes:{"aria-label":an.feedback.votedThumbsUpAriaLabel},"data-automation":"aitaThumbsUp"}):r(ei,{size:20,ariaAttributes:{"aria-label":an.feedback.votedThumbsDownAriaLabel},"data-automation":"aitaThumbsDown"})}):t("div",{className:ti.votingThumbsContainer,children:[r(G,{variant:"primary",icon:x,size:"small",onClick:e?void 0:a,"aria-label":an.feedback.voteThumbsUpAriaLabel,dataAttributes:{"data-automation":"aitaThumbsUp"}}),r(G,{variant:"primary",icon:z,size:"small",onClick:e?void 0:n,"aria-label":an.feedback.voteThumbsDownAriaLabel,dataAttributes:{"data-automation":"aitaThumbsDown"}})]}),td=({feedbackRating:e,onFeedback:a,isOnFeedbackFetching:n})=>{var[s,o]=i(e),[l,d]=i(!1),{openToast:c}=a0(),u=e=>c({textContent:an.feedback["GOOD"===e?"thanksGood":"thanksBad"],variant:"primary",icon:"GOOD"===e?"thumbsUp":"thumbsDown",isDurationLong:!0}),h=e=>{if(!n){var t=e.rating;a(t,e.message).then(a=>{if(!a.ok){c({textContent:an.feedback.error,variant:"error",icon:"error"});return}e.isFlowComplete&&u(t),t!==s&&o(t),d("GOOD"!==t&&!e.isFlowComplete)})}};return t("div",{children:[r("div",{className:ti.thumbsContainer,children:r(tl,{feedbackRating:s,disabled:n,onThumbsUp:()=>{h({rating:"GOOD",isFlowComplete:!0})},onThumbsDown:()=>{h({rating:"BAD",isFlowComplete:!1})}})}),l&&r(to,{feedbackRating:s,disabled:n,onSelect:h,onClose:()=>{u("BAD"),d(!1)}})]})},tc=({feedbackRating:e,threadId:a,messageId:t})=>{var{addFeedback:n,fetching:i}=ta(),s=w(),o=E();return r(al,{feedbackRating:e,onFeedback:async(e,r)=>{s({itemType:"aitaMessage",actionSubType:"rateMessage",threadId:a,messageId:t,feedbackRating:e});var i=await n({threadId:a,messageId:t,rating:e,customFeedback:r});return o({requestName:"addFeedback",error:i.error,hasData:!!i.data}),{ok:!i.error}},isOnFeedbackFetching:i})},tu={__key:0x6a2e91e745a9,id:"6a2e91e745a9d275",loc:{},definitions:[]},th={__key:26084922600521,id:"17b95e8bac499cc5",loc:{},definitions:[]},tm="RpcvS Gi B1 Z BF Cj z Pk PY Pw PK f e",tg="wJnKA f",tp=({threadId:e,messageId:a,locationId:n,postId:i,userProfile:s,forumName:o,topicTitle:l,url:d,body:c,snippets:u})=>{var h={itemType:"aitaForumPostCard",threadId:e,messageId:a,locationId:n,itemId:`${i}`},m=O(h),g=w(),p=t("div",{className:tg,children:[r(j,{color:"onSurface",atlasVariant:"fixed-body-10",lineClamp:1,children:o}),t("span",{"aria-hidden":!0,children:[r(j,{color:"onSurface",atlasVariant:"fixed-body-10",elementType:"span",children:"•\xa0"}),r(eT,{size:14,color:"inherit"})]})]});return t("div",{ref:m,className:tm,...eb("aitaSourceCard"),children:[t("div",{className:"HIEXR f e",children:[r(ev,{variant:"two-line",profileInfo:[s],additionalInfo1:p}),r(j,{atlasVariant:"fixed-label-20",color:"onSurface",lineClamp:2,children:l}),r(j,{atlasVariant:"fixed-body-20",color:"onSurface",lineClamp:8,children:u.length?u[0]:c})]}),r(Y,{href:d,target:"_blank",onClick:()=>g({...h,actionSubType:"clickSeeFullForumPost"}),variant:"primary-small",...eb("aitaSeeFullForumPost"),children:an.chat.seeFullForumPost})]})},tf=({threadId:e,messageId:a,locationId:n,reviewId:i,userProfile:s,publishedDate:o,rating:l,url:d,snippets:c})=>{var u={itemType:"aitaReviewCard",threadId:e,messageId:a,locationId:n,itemId:`${i}`},h=O(u),m=w(),g=ea(),p=`${g.formatDate("date_medium_month_year",o)}`,{contributionCount:f}=s,T=t("div",{className:tg,children:[r(j,{color:"onSurface",atlasVariant:"fixed-body-10",children:p}),r(j,{color:"onSurface",atlasVariant:"fixed-body-10",children:"•"}),r(j,{color:"onSurface",atlasVariant:"fixed-body-10",children:g.formatNumber("integer",f)}),r(eI,{size:14,ariaAttributes:{"aria-hidden":!0}})]});return t("div",{ref:h,className:tm,...eb("aitaSourceCard"),children:[t("div",{children:[r(ev,{variant:"two-line",profileInfo:[s],additionalInfo1:T}),r("div",{className:"Mk MI",children:r(eE,{showRating:!1,size:"small",rating:l})}),r("div",{children:r(j,{atlasVariant:"fixed-body-20",color:"onSurface",lineClamp:8,children:c.length&&c[0]})})]}),r(Y,{href:d,target:"_blank",onClick:()=>m({...u,actionSubType:"clickSeeFullReview"}),variant:"primary-small",...eb("aitaSeeFullReview"),children:r(J,{id:"gai_review_summary_see_full_reviews",messages:"See full review"})})]})},tT={sourceShelfContainer:"Zb Px",scrollableContainer:"_T",sourceShelfScrollable:"zfJeQ _e",sourceShelf:"udkmU f",loadingContainer:"JvoYC f j u e",hasForumPosts:"bzFhD"},tv=({threadId:e,messageId:a,locationId:n,reviewSnippets:o,forumPostSnippets:l})=>{var[d,c]=i(!1),h=u(null),m={itemType:"aitaSourcesCta",threadId:e,messageId:a,locationId:n},g=O(m),p=w();s(()=>{d&&h.current?.scrollIntoView({behavior:"smooth",block:"nearest"})},[d]),tb(d,o.size,l.size);var f=o.size+l.size,T=f>1?an.chat.showSources:an.chat.showSource;return d&&(T=f>1?an.chat.hideSources:an.chat.hideSource),t("div",{ref:g,children:[r(Y,{variant:"primary",onClick:()=>{c(!d),p({...m,actionSubType:d?"collapseSources":"expandSources"})},icon:d?em:eh,trailing:!0,"aria-expanded":d,automationId:"aitaShowSources",children:r(j,{atlasVariant:"fixed-label-20",children:T})}),d&&r("div",{className:tT.sourceShelfContainer,style:{width:`${266*f-16}px`},ref:h,children:r(tN,{threadId:e,messageId:a,locationId:n,reviewSnippets:o,forumPostSnippets:l})})]})},tb=(e,a,t)=>{var[r,n]=i(!1),o=v.useConstantIncrementCallback(1),l=v.useConstantIncrementCallback(2),d=v.useConstantIncrementCallback(3);s(()=>{!r&&e&&(a&&(o(ah,b.UR),o(ah,b.G)),t&&o(ah,b.F2),(a||t)&&(o(ah,b.LK),o(ah,b.M),a?d(ah,b.MEM):l(ah,b.MEM)),n(!0))},[r,e,a,t,o,l,d])},tE=e=>{var{maxWidth:a,maxHeight:t,urlTemplate:r}=e?.photoSizeDynamic??{};return a&&t&&r?{maxWidth:a,maxHeight:t,urlTemplate:r}:void 0},tI=e=>{var a=Array.from(e.keys()),t=!a.length,[{data:r,fetching:n,error:i},s]=X({query:th,variables:{reviewIds:a},pause:t}),l=o(()=>(r?.reviews??[]).filter(Boolean).map(a=>{var{id:t,userProfile:r,publishedDate:n,rating:i,url:s}=a,o=n?new Date(n):null;return t&&r?.displayName&&r?.contributionCounts?.sumAllUgc!=null&&o&&!isNaN(o.valueOf())&&i&&s?{reviewId:t,userProfile:{displayName:r?.displayName,avatarSource:tE(r?.avatar),contributionCount:r?.contributionCounts?.sumAllUgc},publishedDate:o,rating:i,url:s,snippets:e.get(t)??[]}:null}).filter(Boolean),[r?.reviews,e]);return N({requestName:"getReviews",fetching:n,error:i,hasData:!!l.length,isQueryPaused:t}),{reviews:l,fetching:n,error:i,reexcuteReviewsQuery:()=>s({requestPolicy:"network-only"})}},ty=e=>{var a=Array.from(e.keys()),t=!a.length,[{data:r,fetching:n,error:i},s]=X({query:tu,variables:{forumPostIds:a},pause:t}),l=o(()=>(r?.posts??[]).filter(Boolean).map(a=>{var{id:t,userProfile:r,forumName:n,topicTitle:i,body:s,url:o}=a;return t&&r?.displayName&&n&&i&&s&&o?{postId:t,userProfile:{displayName:r?.displayName,avatarSource:tE(r?.avatar)},forumName:n,topicTitle:i,body:s,url:o,snippets:e.get(t)??[]}:null}).filter(Boolean),[r?.posts,e]);return N({requestName:"getForumPosts",fetching:n,error:i,hasData:!!l.length,isQueryPaused:t}),{forumPosts:l,fetching:n,error:i,reexcuteForumsQuery:()=>s({requestPolicy:"network-only"})}},tC=(e,a)=>{var t="";return a?.networkError?t=" - network error":a?.graphQLErrors&&(t=" - gql errors"),`(ids: ${e.size?Array.from(e.keys()).join(", "):"none"}${t})`},tN=({threadId:e,messageId:a,reviewSnippets:n,forumPostSnippets:i,locationId:o})=>{var l="MOBILE"===ep(),{scrollContainerProps:d,scrollButtonsProps:c}=I(10,!1,{itemWidth:(l?230:250)+16}),{reviews:h,fetching:m,error:g,reexcuteReviewsQuery:p}=tI(n),{forumPosts:f,fetching:T,error:v,reexcuteForumsQuery:b}=ty(i),E=m||T,N=u(null);s(()=>{E||N.current?.scrollIntoView({behavior:"smooth",block:"nearest"})},[E]);var _=!E&&!h.length&&!f.length;return(s(()=>{_&&console.error(`AITA: Failed to fetch reviews ${tC(n,g)} and/or forum posts ${tC(i,v)} for thread id ${e} and message id ${a}`)},[_,n,g,v,i,e,a]),E)?r("div",{className:eu(tT.loadingContainer,i.size&&tT.hasForumPosts),children:r(eg,{variant:"large"})}):_?r(y,{errorBody:an.chat.sourcesErrorBody,retry:()=>{p(),b()},retryButtonTitle:an.chat.sourcesErrorCta}):t("div",{ref:N,children:[r("div",{className:tT.scrollableContainer,children:t("div",{className:tT.sourceShelfScrollable,...d,children:[t("div",{className:tT.sourceShelf,children:[h.map(t=>{var{reviewId:n,userProfile:i,publishedDate:s,rating:l,url:d,snippets:c}=t;return r(au,{threadId:e,messageId:a,locationId:o,reviewId:n,userProfile:i,publishedDate:s,rating:l,url:d,snippets:c},`review-${n}`)}),f.map(t=>{var{postId:n,userProfile:i,forumName:s,topicTitle:l,body:d,url:c,snippets:u}=t;return r(ac,{threadId:e,messageId:a,locationId:o,postId:n,userProfile:i,forumName:s,topicTitle:l,body:d,url:c,snippets:u},`forum-post-${n}`)})]}),r(C,{...c,iconVariant:"chevron",showOnTablet:!0,shortShadows:!0,minimizeShadowBlur:!0})]})}),!!h.length&&r(ef,{marginTop:"spacing-02",tooltipVariant:"bottom-caret",includeHamonLawLocales:!0,openLinksInNewTab:!0})]})},t_=({threadId:e,messageId:a,locationId:t,sources:n})=>{var i=new Map,s=new Map;if(n.filter(Boolean).forEach(e=>{"TravelChatManager_ReviewList"===e.__typename?e.reviews.filter(Boolean).forEach(e=>{var{review_id:a,snippets:t}=e,r=t.filter(Boolean);r.length&&!i.has(a)&&i.set(a,r)}):"TravelChatManager_ForumList"===e.__typename&&e.posts.filter(Boolean).forEach(e=>{var{post_id:a,snippets:t}=e,r=t.filter(Boolean);s.has(a)||s.set(a,r)})}),i.size+s.size<1)return null;var o=new Map,l=new Map;for(var d of i.entries()){if(5===o.size)break;var[c,u]=d;o.set(c,u)}for(var h of s.entries()){if(o.size+l.size===5)break;var[m,g]=h;l.set(m,g)}return r(am,{threadId:e,messageId:a,locationId:t,reviewSnippets:o,forumPostSnippets:l})},tS=e=>{if(!e?.details)return!1;var{placeType:a,isGeo:t,locationId:r,name:n,route:i}=e.details;return!!a&&null!=t&&null!=r&&!!n&&!!i?.url},tM=(e,a)=>"COMPLETE"===e&&!a.link,tR=()=>c((e,a)=>tM(e,a),[]),tk=e=>{var a=[];return e.forEach(e=>{if(e.responseData?.__typename==="TravelChatManager_AssistantMessage"){var t=e.responseData?.content?.find(e=>e?.__typename==="TravelChatManager_LocationList");t&&(a=[...a,...t.locations])}}),a.filter(e=>!!tS(e))},tP=e=>"ERROR"===e||"TIMEOUT"===e,tA=e=>{if(!e)return null;var a=e?.__typename==="TravelChatManager_AssistantMessage",t=!(a&&(e?.status==="COMPLETE"||e?.status==="PENDING"||e?.status==="CANCELED"));return{id:e?.messageId,sender:e?.__typename==="TravelChatManager_UserMessage"?"user":"agent",responseData:e,isCancel:a&&e?.status==="CANCELED",isError:t}},tw=({threshold:e,scrollAdjustment:a=10})=>{var t=u(null),[r,n]=i(!1),[s,o]=i(!1),l=et(),d=c(a=>{var r=()=>{a&&(n(l?a.scrollLeft<=-e:a.scrollLeft>=e),o(a.scrollWidth>a.clientWidth+(l?-a.scrollLeft:a.scrollLeft)+e))};t.current&&t.current.removeEventListener("scroll",r),r(),a&&(a.addEventListener("scroll",r),t.current=a)},[e,l]),h=c(()=>{if(t.current){var e=t.current.children[0];if(e instanceof HTMLElement){var r=e.offsetWidth+a;t.current.scrollBy({left:l?-r:r,behavior:"smooth"})}}},[l,a]);return[d,c(()=>{if(t.current){var e=t.current.children[0];if(e instanceof HTMLElement){var r=e.offsetWidth+a;t.current.scrollBy({left:l?r:-r,behavior:"smooth"})}}},[l,a]),h,r,s]};function tO({location:e,lineClamp:a}){var t=ea(),{detail:n}=e,i=null,s=null;if(n?.__typename==="Hotel"&&(i=n.priceRange?.minimum??null,s=n.priceRange?.maximum??null),!i||!s)return null;var o=`${t.formatCurrencyInteger(i)} - ${t.formatCurrencyInteger(s)}`;return r(j,{display:"inline-block",atlasVariant:"fixed-body-20",color:"onSurfaceVariant",lineClamp:a,children:r(J,{id:"trips_hotel_price_dated",args:{price:r(j,{atlasVariant:"fixed-label-20",elementType:"span",color:"onSurface",children:o})},messages:"{price} per night"})})}var tL=e=>{switch(e){case"HOTEL":return 1;case"BB":return 2;case"OTHER":return 3;case"COLLAPSED_BB_INN":return 99;case"VR":return 6;default:return 0}};function tD({location:e,lineClamp:a}){var{popIndexRank:t,popIndexTotal:n}=e?.popIndexDetails??{};return e?.accommodationCategory&&t&&n?r(j,{atlasVariant:"fixed-body-20",color:"onSurfaceVariant",lineClamp:a,children:r(er,{id:"common_n_of_n_lodgingtype_in_geo_pl",args:{1:t,2:n,3:tL(e?.accommodationCategory),4:e?.geoName},messages:"#{1,number,integer} of {2,number,integer} {3, select, 1 {hotels} 2 {B&Bs / Inns} 3 {Specialty lodging} 6 {Vacation rentals} other {}} in {4}"})}):null}var tB=({location:e})=>{var a=e.locationV2?.names?.longOnlyHierarchyTypeaheadV2;return a?r(eB,{content:a,icon:eD}):null};function tQ({lineClamp:e,tagsInfo:a}){var t=a?.reduce((e,a)=>a?.localizedName&&244===a.categoryId&&(e.push(a.localizedName),e.length>=2)?e.slice(0,2):e,[])?.join(", ");return t?r(j,{atlasVariant:"fixed-body-20",color:"onSurfaceVariant",lineClamp:e,children:t}):null}function tz({location:e,lineClamp:a}){var{localize:t}=en(),n=ea(),{popIndexRank:i,popIndexTotal:s}=e.popIndexDetails||{};return i&&s&&e.geoName?r(j,{atlasVariant:"fixed-body-20",color:"onSurfaceVariant",lineClamp:a,dataAttributes:{"data-automation":"flyout-attraction-ranking"},children:r(J,{id:"trips_v2_fly_out_ranking_4",args:{position:n.formatNumber("integer",i),total:n.formatNumber("integer",s),locationType:t.string("things to do","trips_v2_fly_out_ranking_things_to_do"),locationName:e.geoName},messages:"#{position} of {total} {locationType} in {locationName}"})}):null}function tx({link:e}){return e?t("div",{className:"f Q1",children:[r(eH,{size:16,color:"primaryIcon"}),r(U,{theme:"inline",href:e,target:"_blank",children:r(j,{elementType:"span",atlasVariant:"fixed-body-20",color:"inherit",children:r(J,{id:"restaurants_contact_links_menu",messages:"Menu"})})})]}):null}function tW({location:e,menu:a,lineClamp:i}){var s,{localize:o}=en(),l=o("Restaurant","common_Restaurant_3dd"),d=e.cuisines?.reduce((e,a)=>(a?.localizedName&&e.length<2&&e.push(a.localizedName),e),[])||[],c=e.price?.[0]?.localizedName??null,u=c?d.concat(c):d;return a?.menuUrl?s=a.menuUrl:a?.hasProvider&&e.route?.url&&(s=`${e.route.url}#menu`),t("div",{className:ez("_W K Q1",ex({lineClamp:i})),children:[t(j,{elementType:"span",atlasVariant:"fixed-body-20",color:"onSurfaceVariant",display:"flex",children:[r(eQ,{size:16,marginRight:"spacing-01"}),l]}),u.length>0?" • ":null,u.map((e,a)=>t(j,{elementType:"span",atlasVariant:"fixed-body-20",color:"onSurfaceVariant",children:[e,a<u.length-1?" • ":""]},e)),s?t(n,{children:[" • ",r(tx,{link:s})]}):null]})}function tH({lineClamp:e,tagsInfo:a}){var t=eV(a?.map(e=>e?.tagId).filter(Boolean)??[]),n=a?.find(e=>e?.tagId===t),i=n?.localizedName||a?.[0]?.localizedName;return i?r(j,{atlasVariant:"fixed-body-20",color:"onSurfaceVariant",lineClamp:e,children:i}):null}function tV({location:e,lineClamp:a}){var t=ea(),n=e.locationV2?.details,i=n?.__typename==="LocationSelection_AttractionProductDetails"?{price:n?.productDetails?.pricingInfo?.fromPrice??null,isTieredPricing:n?.productDetails?.pricingInfo?.isTieredPricing??!1,isPerGroupPricing:n?.productDetails?.pricingInfo?.pricingType==="UNIT",flexibleDisplayDuration:n?.productDetails?.displayDuration?.__typename==="ExpPresentationService_FlexibleDisplayDuration"?n?.productDetails?.displayDuration:null}:null;return i?.price?r(j,{atlasVariant:"fixed-body-20",color:"onSurfaceVariant",lineClamp:a,children:r(eK,{price:r(j,{atlasVariant:"fixed-label-20",display:"inline-block",elementType:"span",color:"onSurface",children:t.formatCurrency(i.price)}),isTieredPricing:i.isTieredPricing,isPerGroupPricing:i.isPerGroupPricing})}):null}var tK=({location:e,tagsInfo:a})=>{if(e.isGeo)return r(ap,{location:e});var t=e.locationV2?.tags?.tags?.find(e=>e?.tagId===11066);switch(e.placeType){case"ACCOMMODATION":return r(tq,{location:e});case"EATERY":return r(tG,{location:e});case"ACTIVITY":return r(tY,{location:e,tagsInfo:a});case"ATTRACTION":if(t)return r(tF,{location:e,tagsInfo:a});return r(tj,{tagsInfo:a});default:return null}},tq=({location:e})=>t(n,{children:[r(tD,{location:e,lineClamp:1}),r(tO,{location:e,lineClamp:1})]}),tG=({location:e})=>r(tW,{location:e,lineClamp:1}),tY=({location:e,tagsInfo:a})=>t(n,{children:[r(tH,{lineClamp:1,tagsInfo:a}),r(tV,{location:e,lineClamp:1})]}),tj=({tagsInfo:e})=>r(tQ,{lineClamp:1,tagsInfo:e}),tF=({location:e,tagsInfo:a})=>t(n,{children:[r(tQ,{lineClamp:1,tagsInfo:a}),r(tz,{location:e,lineClamp:1})]}),tU={container:"WiXwJ z I W _X",card:"IdRsz Cj Gi Re o",imageContainer:"YdkBi I",info:"kKjNx e Q1"},tZ={buttonsContainer:"DJYdd u f k l _Q w",filler:"f H",previousButton:"iTdnw NL",nextButton:"vswka Nj"},tX=({scrollBack:e,scrollForward:a})=>{var{localize:n}=en();return t("div",{className:tZ.buttonsContainer,children:[e&&r("div",{className:tZ.previousButton,children:r(G,{"aria-label":n.string("Previous","common_Previous"),variant:"primary-border",icon:eq,onClick:e,automationId:"aitaMapCarouselPrevious"})}),r("div",{className:tZ.filler}),a&&r("div",{className:tZ.nextButton,children:r(G,{"aria-label":n.string("Next","common_Next"),variant:"primary-border",icon:eG,onClick:a,automationId:"aitaMapCarouselNext"})})]})},t$=({threadId:e,messageId:a,locations:i,listElementsRef:s,listContainerRef:o,onCardChange:l,tagsInfoMap:d})=>{var{selectMarker:h}=eM(),m=u(null),g=u(!1),[p,f,T,v,b]=ag({threshold:100}),E=e=>{if(!e)return!1;var a=e.getBoundingClientRect(),t=o.current?.getBoundingClientRect();return a.left>=(t?.left??0)&&a.right<=(t?.right??0)},I=c((e,a)=>{a&&l?.(e),h?.(e)},[h,l]),y=u(eA(()=>{var e=(m.current?.scrollLeft??0)>100,a=g.current||e;for(var[t,r]of s.current??new Map)if(E(r)){I(String(t),a),g.current=!0;break}},30));return t(n,{children:[r("div",{className:"EsGyW Q2 _t q",ref:e=>{m.current=e,p(e)},onScroll:y.current,"data-automation":"aita_map_item_carousel",children:i.map((t,n)=>r(aT,{index:n,threadId:e,messageId:a,ref:e=>{s&&"function"!=typeof s&&t?.details?.locationId&&(e?s.current?.set(String(t?.details?.locationId),e):s.current?.delete(String(t?.details?.locationId)))},location:t?.details||null,locationReviewSummary:t?.reviewRatingAndCount||null,tagsInfo:d&&t?.details?.locationId?d.get(t.details.locationId):void 0},t?.details?.locationId))}),r("div",{className:"JqoPO u S t w _Z",children:r(av,{scrollBack:v?f:void 0,scrollForward:b?T:void 0})})]})},tJ={__key:56623040765752,id:"337f943b1f38a391",loc:{},definitions:[]},t0=e=>{var a=[];return(e.forEach(e=>{var t=e?.details||null;null!==t&&null!==t.latitude&&null!==t.longitude&&a.push(new eN(t.latitude,t.longitude))}),a.length)?e_.fromArray(a):null},t1=e=>{if(e.tags?.find(e=>e?.tagId===11066))return eU;switch(e.placeType){case"ATTRACTION":return ej;case"EATERY":return eZ;case"ACCOMMODATION":return eF;default:return eD}},t2=e=>"BOTB"===e?"best-of-the-best":"default",t4=({location:e,selected:a,onClick:t,onMouseEnter:n,onMouseLeave:i})=>{var s,l=o(()=>new eN(e.latitude,e.longitude),[e]),[{data:d}]=eY({query:tJ,variables:{saveObjects:[{id:e.locationId?.toString(),type:"location"}]},requestPolicy:"network-only",pause:!e.locationId},{Trips_addItemReferences:()=>"invalidateAndRefetch",tripsRemoveReference:()=>"invalidateAndRefetch",Trips_createTrip:()=>"invalidateAndRefetch"}),u=c(()=>{t?.(e.locationId)},[t,e.locationId]),h=c(()=>{n?.(e.locationId)},[n,e.locationId]),m=c(()=>{i?.(e.locationId)},[i,e.locationId]);e.isGeo||(s=e.reviewSummary?.rating??void 0);var g=!!d?.Trips_isSaved?.[0];return r(eR,{markerId:`${e.locationId}`,position:l,icon:t1(e),isSaved:g,rating:s,travelersChoice:e.awardType?{variant:t2(e.awardType)}:void 0,onMouseEnter:h,onMouseLeave:m,onClick:u,markerAutomation:{automationId:a?"aitaTripMapMarkerSelected":"aitaTripMapMarker"},iconAutomation:{automationId:g?"aitaSavedPinIcon":void 0}})},t3={container:"GJQvE w _Z MJ Re o z",loadingOverlay:"DHARJ w _Z",carouselContainer:"DPaIe w Z1",zoomControl:"MsHgE"},t6=({threadId:e,messageId:a,locations:n,loading:l,onZoomChange:d,onPinClick:h,wrapperRef:m,onPanStart:g,tagsInfoMap:p,onMapNotSupported:f})=>{var T=w(),v="MOBILE"===ep(),{selectMarker:b,selectedMarkerId:E}=eM(),I=u(new Map),y=u(null),[C,N]=i(null),[_,S]=i(!0),M=e=>{e&&I.current.get(e)?.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})},R=c(t=>{S(!1),b?.(String(t)),h?.(t),t&&(M(String(t)),T({itemType:"aitaMap",actionType:"click",actionSubType:"mapLocationIconClicked",threadId:e,messageId:a,itemId:String(t)}))},[h,b,T,e,a]),k=c(e=>{!l&&e.userGesture&&d?.(e)},[l,d]),P=o(()=>n.find(e=>String(e?.details?.locationId)===E),[n,E]);s(()=>{if(C&&E&&P&&P?.details?.latitude&&P?.details?.longitude&&!_){var e=C.getBounds(),a=new eN(P.details.latitude,P.details.longitude),t=eS.getPaddedBounds(a,C.getZoom(),aI),r=!e.containsPoint(a),n=t&&!e.containsBounds(t);(r||n)&&C.panIntoView(a,aI)}},[C,E,P,_]);var A=o(()=>n.map(e=>e?.details?.locationId&&e.details.latitude&&e.details.longitude?{locationId:e.details.locationId,isGeo:e.details.isGeo,placeType:e.details.placeType,latitude:e.details.latitude,longitude:e.details.longitude,name:e.details.name,reviewSummary:e.reviewRatingAndCount?.responseData?{count:e.reviewRatingAndCount.responseData.count,rating:e.reviewRatingAndCount.responseData.rating}:null,awardType:e.details.locationV2?.bestAwardForActiveYearV2?.awardType,tags:e.details.locationV2?.tags?.tags}:null).filter(Boolean),[n]),O=o(()=>n.length>0?t0(n):null,[n]);return t("div",{ref:m,className:t3.container,"data-automation":"aita_map_item_map",children:[t(eP,{boundsPadding:aI,onClick:()=>{b?.(null)},onZoomChange:k,onPanStart:g,onRenderComplete:e=>{var a=e.map,t=a.getZoom(),r=a.getMinZoom();a.setMinZoom(Math.max(t-3,r)),N(e.map);var n=A[0]?.locationId;n&&b?.(String(n))},onMapNotSupported:f,cooperativeGestures:!0,initialBounds:O,children:[!v&&!l&&r("div",{className:t3.zoomControl,children:r(eC,{variant:"Square",zoomInAutomationId:"aitaMapZoomIn",zoomOutAutomationId:"aitaMapZoomOut"})}),A.map(e=>r(aE,{selected:E===String(e.locationId),location:e,onClick:R},e.locationId)),E&&r("div",{className:t3.carouselContainer,ref:y,children:r(ab,{threadId:e,messageId:a,locations:n,listElementsRef:I,listContainerRef:y,onCardChange:t=>{_&&S(!1);var r=n.findIndex(e=>`${e?.details?.locationId}`===t);t&&r>=0&&T({itemType:"aitaMap",actionType:"click",actionSubType:"mapScrollClick",threadId:e,messageId:a,itemId:t,mapScrollDepth:r+1})},tagsInfoMap:p})})]}),l&&r("div",{className:t3.loadingOverlay})]})},t9=e=>r(ek,{children:r(t6,{...e})}),t7={__key:0xf402a892aaed,id:"f402a892aaed3e02",loc:{},definitions:[]};function t5({location:e,lineClamp:a}){var[{fetching:t,data:n}]=X({query:t7,variables:{locationId:e.locationId||0},pause:!e.locationId});if(t)return r(e$,{width:"100%",height:"17px"});var i=n?.attraction?.[0]?.details?.recommendedVisit;return i?r(j,{atlasVariant:"fixed-body-20",color:"onSurfaceVariant",lineClamp:a,children:r(J,{id:"trips_cards_icon_content_duration",args:{sDuration:i},messages:"Duration: {sDuration}"})}):null}function t8({location:e,menu:a,tagsInfo:t}){if(!e.placeType)return null;var n=e.locationV2?.tags?.tags?.find(e=>e?.tagId===11066);switch(e.placeType){case"ACCOMMODATION":return r(re,{location:e});case"EATERY":return r(ra,{location:e,menu:a});case"ACTIVITY":return r(rt,{location:e,tagsInfo:t});case"ATTRACTION":if(n)return r(rn,{location:e,tagsInfo:t});return r(rr,{location:e,tagsInfo:t});default:return null}}function re({location:e}){return t(n,{children:[r(tD,{location:e}),r(tO,{location:e})]})}function ra({location:e,menu:a}){return r(tW,{location:e,menu:a})}function rt({location:e,tagsInfo:a}){return t(n,{children:[r(tH,{tagsInfo:a}),r(tV,{location:e})]})}function rr({location:e,tagsInfo:a}){return t(n,{children:[r(tQ,{tagsInfo:a}),r(t5,{location:e})]})}function rn({location:e,tagsInfo:a}){return t(n,{children:[r(tQ,{tagsInfo:a}),r(tz,{location:e})]})}var ri={card:"sNRSm Fi",stack:"JsBMk",columns:"cTOwe Fi k",saveButton:"I"};function rs({location:e,menu:a,locationReviewSummary:i,onSaveClick:s,onSaveComplete:o,onNameLinkClick:l,tagsInfo:d}){var c,u=ep(),h="MOBILE"===u,m="DESKTOP"===u,g=null;e.isGeo?g=r(ap,{location:e}):i?.responseData?.rating!=null&&i?.responseData?.count!=null&&(c={rating:i.responseData.rating,reviewCount:i.responseData.count});var p=r(j,{lineClamp:2,atlasVariant:"fixed-label-30",dataAttributes:{"data-automation":"aitaRecommendationTitle"},color:"onSurface",children:e.name}),f=e.route?.url?r(U,{href:e.route?.url,theme:"standalone",target:"_blank",onClick:l,children:p}):p,T=h?t("div",{className:ri.stack,children:[t("div",{className:ri.columns,children:[t("div",{className:ri.stack,children:[f,g,c?r(eE,{size:"small",showRating:!1,rating:c.rating,reviewCount:c.reviewCount}):null]}),r("div",{className:ri.saveButton,children:r(Z,{id:e.locationId,asButton:!h,roundedBackground:!h,variant:"primary-border",bookmarkStyle:"circular-button",renderLabel:h?void 0:e=>e,saveSourceOrigin:"AI_TRAVEL_ASSISTANT",onClick:s,onSaveComplete:o})})]}),r(t8,{location:e,menu:a,tagsInfo:d})]}):t(n,{children:[t("div",{className:ri.stack,children:[f,g,c?r(eE,{size:"small",showRating:!1,rating:c.rating,reviewCount:c.reviewCount}):null,r(t8,{location:e,menu:a,tagsInfo:d})]}),r("div",{className:ri.saveButton,children:r(Z,{id:e.locationId,asButton:m,roundedBackground:m,variant:"primary-border",bookmarkStyle:"circular-button",renderLabel:m?e=>e:void 0,saveSourceOrigin:"AI_TRAVEL_ASSISTANT",onClick:s,onSaveComplete:o})})]});return t("div",{className:ri.card,children:[r(ew,{source:e.thumbnail?.photoSizeDynamic,width:70,height:70,roundingSize:"medium"}),T]})}var ro=({location:e,menu:a,locationReviewSummary:t,threadId:n,messageId:i,tagsInfo:s})=>{var o=D(),{locationId:l}=e,d={itemType:"aitaLocationCard",threadId:n,messageId:i,itemId:`${l}`,isBookableAttractionProduct:e.locationV2?.details?.__typename==="LocationSelection_AttractionProductDetails"&&e.locationV2?.details?.productDetails?.pricingInfo!=null,viewType:"LIST"},c=O({...d,saveable:!0}),u=w(),h=function(e){switch(e){case"ATTRACTION":case"ACTIVITY":return"Attraction";case"EATERY":return"Restaurant";case"ACCOMMODATION":return"Hotel";default:return e}}(e.placeType);return r("div",{ref:c,className:"_T Gi","data-automation":h?`recommendationItem_${h}`:void 0,children:r(rs,{location:e,menu:a,locationReviewSummary:t,tagsInfo:s,onSaveClick:()=>u({...d,actionSubType:"clickSaveButton"}),onSaveComplete:(e,a,t)=>{u({...d,actionSubType:"saveLocationToTrip",tripId:t,tripSaveType:a}),_(o)},onNameLinkClick:()=>u({...d,actionSubType:"openLocationDetails"})})})},rl=({locations:e,threadId:a,messageId:i})=>{var s=e.map(({menu:e,details:s,reviewRatingAndCount:o,sources:l,tagsInfo:d})=>{var{locationId:c}=s,u=t_({threadId:a,messageId:i,locationId:c,sources:l});return t("li",{className:eu("iBMiJ Gi Re MJ",{CuIal:!u}),children:[r(aC,{threadId:a,messageId:i,location:s,menu:e,locationReviewSummary:o,tagsInfo:d}),u?t(n,{children:[r(eX,{marginTop:"spacing-03"}),u]}):null]},c)}).filter(Boolean);return r("ul",{children:s})},rd={tabs:"Xb MJ NB"},rc=({locationList:e,threadId:a,messageId:s,mapViewEnabled:l,tagsInfoMap:d})=>{var[c,u]=i(!0),h=w(),m=O({itemType:"aitaMap",threadId:a,messageId:s}),g=e.filter(e=>!!tS(e)).map(e=>{var{placeType:a,isGeo:t,locationId:r,name:n,route:i}=e.details,s=e.reviewRatingAndCount?.responseData?.count!=null&&null!=e.reviewRatingAndCount.responseData.rating&&e.reviewRatingAndCount.responseData.rating>=0;return{details:{...e.details,placeType:a,isGeo:t,locationId:r,name:n,route:{url:i.url}},menu:e.menu??void 0,reviewRatingAndCount:s?e.reviewRatingAndCount:null,sources:e.sources,tagsInfo:d?.size?d?.get(Number(r)):void 0}}),p=o(()=>[{state:"map",label:an.chat.map,dataAutomation:"aitaMapRecommendationsSwitch"},{state:"list",label:an.chat.list,dataAutomation:"aitaListRecommendationsSwitch"}],[]),[f,T]=i(p[0].state),v=o(()=>0!==g.filter(e=>e.details?.latitude!==null&&e.details?.longitude!==null).length,[g]);if(!g.length)return null;if(c&&l&&v){var b=f===p[0].state?r(S,{component:"chat_map",children:r(ay,{wrapperRef:m,threadId:a,messageId:s,locations:e,tagsInfoMap:d,onMapNotSupported:()=>{u(!1)}})}):r(aN,{locations:g,threadId:a,messageId:s});return t(n,{children:[r("div",{className:rd.tabs,children:r(ey,{bordered:!0,states:p,onStateChange:e=>{T(e),h({itemType:"aitaMap",actionType:"click",actionSubType:"mapListToggle",toggleType:"map"===e?"MAP":"LIST",threadId:a,messageId:s})},activeState:f})}),b]})}return r(aN,{locations:g,threadId:a,messageId:s})},ru="egcLq",rh="ORLqq",rm=({children:e})=>r(j,{atlasVariant:"fixed-body-30",dataAttributes:{"data-automation":"aitaNarrationItem"},children:e}),rg=()=>r(rm,{children:r("span",{role:"alert",children:an.chat.canceledMessage})}),rp=()=>an.chat.errorMessages[Math.floor(Math.random()*an.chat.errorMessages.length)],rf=()=>{var e=o(()=>rp(),[]);return r(rm,{children:r("span",{role:"alert",children:e})})},rT=e=>{var a=/(?:\n|\r|\n\r|^) *$/u;return e.replace(/- /gmu,(e,t,r)=>r.substring(0,t).match(a)?e:"\\- ")},rv=({threadId:e,messageId:a,markdownText:t})=>r(F,{overrides:{p:{props:{className:"WRgTA"}},li:{props:{className:"QKKjg NM"}},ul:{props:{className:ru}},ol:{props:{className:ru}},hr:{props:{className:ru}},a:{component:({href:t,children:n})=>t?r(rb,{href:t,threadId:e,messageId:a,children:n}):r("span",{children:n})},h1:{component:({children:e})=>r(j,{elementType:"h1",atlasVariant:"fixed-title-10",color:"inherit",marginY:"spacing-01",children:e})},h2:{component:({children:e})=>r(j,{elementType:"h2",atlasVariant:"fixed-label-30",color:"inherit",marginY:"spacing-01",children:e})},h3:{component:({children:e})=>r("h4",{className:rh,children:e})},h4:{component:({children:e})=>r("h5",{className:rh,children:e})},h5:{component:({children:e})=>r("h6",{className:rh,children:e})}},children:rT(t)}),rb=({variant:e="inline",threadId:a,messageId:t,href:n,trackedUrl:i,children:s})=>{var o={itemType:"aitaLink",threadId:a,messageId:t,itemId:i??n,linkType:"buttonBorderless"===e?"cta":"inline"},l=O(o),d=w();return"buttonBorderless"===e?r(Y,{ref:l,href:n,target:"_blank",onClick:()=>d({...o,actionSubType:"openLink"}),dataAttributes:{"data-automation":"aitaChatResponseLink"},children:s}):r(U,{ref:l,theme:"inline",href:n,target:"_blank",onClick:()=>d({...o,actionSubType:"openLink"}),"data-automation":"aitaChatResponseLink",children:s})},rE=({threadId:e,messageId:a,impression:t,markdown:n})=>r("div",{ref:O({...t,saveable:t.saveable}),children:r(rm,{children:r(rv,{threadId:e,messageId:a,markdownText:n})})}),rI=({id:e,markdown:a,geoId:t,baseTrackingEvent:n})=>{var i=D(),s=w();return r(Z,{id:e,type:"aiassistantmessage",messageMarkdownBody:a,saveSourceOrigin:"AI_TRAVEL_ASSISTANT",predefinedLocationId:t,onClick:()=>s({...n,actionSubType:"clickTextBlockSaveButton"}),onSaveComplete:(e,a,t)=>{s({...n,actionSubType:"saveTextBlockToTrip",tripId:t,tripSaveType:a}),_(i)}})},ry=({threadId:e,messageId:a,status:n,content:i,resolvedGeoIds:s,feedbackRating:o,isMapViewEnabled:l,tagsInfoMap:d})=>{var c={sender:"agent",id:a};if("CANCELED"===n)return{...c,isPending:!1,contents:[{type:"text",content:r(rg,{})}]};if(tP(n))return{...c,isPending:!1,contents:[{type:"text",content:r(rf,{}),backgroundColor:"red"}]};var u=s?.length===1?s[0]:null,h=[];return(i??[]).forEach((s,o)=>{if(s){var c=s.__typename,m=`${a}-${o}`;switch(c){case"TravelChatManager_Text":if(i){var g=t_({threadId:e,messageId:a,sources:s.sources}),p=rC(s.link,a,e),f={itemType:"aitaTextBlock",threadId:e,messageId:a,itemId:m},T=s.content,v=tM(n,s)?r(rI,{id:m,markdown:T,geoId:u,baseTrackingEvent:f}):void 0;h.push({saveButton:v,type:"text",content:t("div",{role:"alert",children:[r(rE,{threadId:e,messageId:a,impression:{...f,saveable:!!v},markdown:T}),p,g]})})}return;case"TravelChatManager_LocationList":h.push({backgroundColor:"transparent",type:"list",content:r(a_,{threadId:e,messageId:a,locationList:s.locations,mapViewEnabled:l,tagsInfoMap:d})});return;default:console.error(`Unhandled chat message content type: ${c}`)}}}),("COMPLETE"===n||"INAPPROPRIATE_PROMPT"===n)&&h.length&&(h[h.length-1].footer=r(ad,{threadId:e,messageId:a,feedbackRating:o??void 0})),{...c,isPending:"PENDING"===n,contents:h}},rC=(e,a,t)=>{var n=e?.route?.webLinkUrl,i=e?.route?.url??void 0,s=e?.anchorText?.value;return e&&n&&s?r(rb,{variant:"buttonBorderless",href:n,trackedUrl:i,messageId:a,threadId:t,children:s}):null},rN="data-message-id",r_=({containerElement:e,assistantMessageId:a,userMessageId:t})=>{var r=(e?.scrollTop??0)+(e?.getBoundingClientRect()?.height??0),n=(e?.scrollHeight??0)-r;return!e||n>60?null:()=>{var r=t?e.querySelector(`[${rN}="${t}"]`):void 0,n=e.querySelector(`[${rN}="${a}"]`);if(n){var i=e.getBoundingClientRect().y;if(!r){var s=n.getBoundingClientRect().y-i-72;if(s<10)return;e.scrollBy({top:s,behavior:"smooth"});return}var o=r.getBoundingClientRect().y-i-72;o<0||o>e.getBoundingClientRect().height||e.scrollBy({top:o,behavior:"smooth"})}}},rS=({containerElement:e,assistantMessageId:a,userMessageId:t})=>{var r=r_({containerElement:e,assistantMessageId:a,userMessageId:t});r&&setTimeout(r,5)},rM={yes:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfOAjyrsIbEtkNHprpWsMGKXVUA36dlwbwvp72Z5MyaHWw==",no:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfPeE63jtwgJHhDoCL+Frrrn"},rR=e=>e.replace(/^#{1,6}\s?/gmu,"").replace(RegExp("(?:\\*\\*|__)(?<boldText>.*?)\\1","gu"),"$<boldText>").replace(RegExp("(?:\\*|_)(?<italicText>.*?)\\1","gu"),"$<italicText>").replace(/\n{2,}/gu,"\n").replace(RegExp("\\[(?<linkText>[^\\]]+)\\]\\([^)]+\\)","gu"),"$<linkText>").trim(),rk=e=>e?.some(e=>e?.__typename==="TravelChatManager_LocationList"&&e.locations.some(e=>!e?.details?.isGeo))?"RECOMMENDATIONS":e?.some(e=>e?.__typename==="TravelChatManager_Text"&&(e.link||e.content.match(/\[[^\]]+\]\([^)]+\)/u)))?"TEXT_WITH_LINK":"TEXT_ONLY",rP=e=>{var a=w(),t=aM.useConstantIncrementCallback(1),r=aR.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2mvXC1F1QD1GAQ/Ftk3D3TA=="),n=aR.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2e0NTaHthS2OXssxKll5TzQ=="),i=aR.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2ErxijeWU05OEv3RbyJAjq/jsfto8jASOk79+ZWECu3Q="),s=aR.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2jPA2HCMlQO4iMsQnWJsppU+Q+LqZZ8ZlPLI7SPLeTp4="),l=aR.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2C8w6YwozyLN+aqlWTRTWkX6pA4b4zODuYL/AURXsmuU="),d=aR.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2ant5d7sB0ZbWI5b6tWQzjlKPVeBEGE0fAIjRYYWsU/Y="),u=aR.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2KoreqLBSPNumuAk6b0SAnq/0coHBIy8Ky4FFPHott5k="),h=aR.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2SY/UpGjfIFzRF7h1B6Dsew=="),m=aR.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2ifQyq41qiG+v6tgn+Znxi9dbcJM+4aYNLzD0DLM1N7c="),g=aR.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2yIbEkrXdo88ME3fnfuCpE0rbKeuSVbHGD5Dvr2kx+H4="),p=aR.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2PTCJYqbxmE/1tw8yYOlMVPxkWYdpewW+bHVzSqZQpIo="),f=aR.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2dEO1vlbbi7o00nG/wrtoalPid4TPt1fydBZsD1kBHdo="),T=aR.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2qohvUUh1SJVxHoLzmh+Stp3PeHIalM9icFKbX+Vo/sg="),v=aR.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2QfE9UFK8Pe00xpa/tkofs78n8Qxcg8tUcE8+mxAmVjs="),b=aR.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2kZKRR5p/OVVlahfTe6QDJvF3cuyrJiKxIsnAv6X+/vg="),E=aR.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2TZU3VFp7Zb843+Af7rfAfg=="),I=aR.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2ruXb3HAYaiiPXEU8ZJEQ7LTe2csLjDSYmFZI1b2oHIc="),y=aR.useIncrementCallback("EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNfvXZcbz71bdtDNETEp7u2XBvgBA0JMp9tr5M4K3TdG/OtV/t4HEXRZim2AIa5txs="),C=o(()=>({CANCELED:r,COMPLETE:n,INAPPROPRIATE_PROMPT:i,SEND_NETWORK_ERROR:s,SEND_INVALID_RESPONSE:l,SEND_EMPTY_RESPONSE:d,SEND_GRAPHQL_ERROR:u,SEND_TIMEOUT:h,SEND_SERVER_ERROR:m,SEND_SERVER_TIMEOUT:g,ANOTHER_PROMPT_PENDING:p,POLL_NETWORK_ERROR:f,POLL_INVALID_RESPONSE:T,POLL_EMPTY_RESPONSE:v,POLL_GRAPHQL_ERROR:b,POLL_TIMEOUT:E,POLL_SERVER_ERROR:I,POLL_SERVER_TIMEOUT:y}),[p,r,n,i,v,b,T,f,I,y,E,d,u,l,s,m,g,h]),N=tR();return c(({threadId:r,messageId:n,status:i,message:s,error:o})=>{var l=s?.some(e=>e?.__typename==="TravelChatManager_Text"&&N(i,e)||e?.__typename==="TravelChatManager_LocationList"&&e.locations.some(e=>tS(e))),d=s?s.reduce((e,a)=>a?.__typename==="TravelChatManager_Text"?e+rR(a.content).length:e,0):0,c=e.current?Date.now()-e.current:void 0;a({itemType:"aitaMessagesPanel",actionType:"other",actionSubType:"settleAssistantMessage",threadId:r,messageId:n,messageStatus:i,messageLatency:c,textLength:d,messageError:o,saveable:l,responseType:s?rk(s):void 0});var u="ERROR"===i?o:i;t(ak[u],void 0===c?rM.no:rM.yes),void 0!==c&&C[u](c)},[a,t,C,e,N])},rA="TMP-ID-1-1",rw=()=>`TMP-ID-${Math.random()}-${Math.random()}`,rO=e=>e[e.length-1]?.isPending?e[e.length-1].id:void 0,rL=(e,a)=>({sender:"agent",isError:!0,isPending:!1,id:e,refetch:a}),rD=({initialThreadId:e})=>{var a=w(),t=E(),r=u(null),[n,o]=i(e),[l,d]=i(e?[]:[aA]),[h,m]=i(e?[]:[aA]),[g,p]=i(null),f=u(null),T=u(null),v=aP(T),[b,I]=i({messageId:null,pauseQuery:!0}),{sendMessage:y,fetching:C}=a8(),{cancelPendingMessage:_,fetching:S,error:M}=te(),R=!e,[{data:k,fetching:P,error:A},O]=a5({threadId:e??"",limit:10},R);N({requestName:"getMessages",fetching:P,error:A,hasData:!!k,isQueryPaused:R});var L=!e||b.pauseQuery||!b.messageId,[D,B]=a5({threadId:e??"",limit:5,messageId:b.messageId??void 0},L);N({requestName:"getMessages",fetching:D.fetching,error:D.error,hasData:!!D.data,isQueryPaused:L});var Q=u(0),z=!n||!g?.assistantMessageId,[{data:x,fetching:W,error:H},V]=a5({threadId:n??"",limit:1,messageId:g?.assistantMessageId??""},z);N({requestName:"getMessages",fetching:W,error:H,hasData:!!x,isQueryPaused:z});var K=c((e,i={})=>{if(!f.current){Q.current=0;var s=rw();f.current=s,p(null),T.current=Date.now();var{text:l,type:c,origin:u,promptType:h,promptScrollDepth:g}=e,b=rw();d(e=>[...e,{sender:"user",id:b,rawMessage:l},{sender:"agent",id:s,isPending:!0}]),setTimeout(()=>{r.current&&r.current.scroll({top:r.current.scrollHeight,behavior:"smooth"})},5);var E=()=>K(e,{...i,isResent:!0}),I=setTimeout(()=>{f.current=null,d(e=>e.map(e=>e.id!==s?e:rL(s,E))),aS({containerElement:r.current,assistantMessageId:s,userMessageId:b}),v({threadId:n,status:"ERROR",error:"SEND_TIMEOUT"})},1e4);y({userId:i.userId,threadId:n,text:l}).then(T=>{if(clearTimeout(I),t({requestName:"addMessage",error:T.error,hasData:!!T.data}),f.current&&s===f.current){var y=T.data?.TravelChatManager_addMessage,C=y?.status,N=y?.reply,_=N?.promptMessageId,S=N?.messageId,M=N?.threadId;if(a({itemType:"aitaMessagesPanel",actionSubType:"submitMessage",threadType:void 0===n?"NEW":"EXISTING",threadId:M,messageId:_,messageType:c,messageOrigin:u,textLength:l.length,messageResent:i.isResent,promptType:h,promptScrollDepth:g,preLoginGateState:i.preLoginGateState??"LOGGED_IN"}),T.error?.networkError||!C||!N||"ANOTHER_PROMPT_PENDING"===C||!M||!S||!_){d(e=>e.map(e=>e.id!==s?e:rL(s,E))),setTimeout(()=>{r.current&&r.current.scroll({top:r.current.scrollHeight,behavior:"smooth"})},5),f.current=null;var R="SEND_INVALID_RESPONSE";T.error?.networkError?R="SEND_NETWORK_ERROR":"ANOTHER_PROMPT_PENDING"===C&&(R="ANOTHER_PROMPT_PENDING"),v({threadId:M??n,messageId:S,status:"ERROR",error:R});return}M!==n&&o(M);var k={sender:"agent",id:N.messageId,responseData:{...N,__typename:"TravelChatManager_AssistantMessage"}},P="PENDING"===N.status,A=!P&&!N.content?.length||tP(N.status),w=A?rL(s,E):{...k,isPending:P};if(d(e=>e.map(e=>e.id===s?w:e.id===b?{...e,id:_}:e)),A||m([{...k,isPending:P}]),aS({containerElement:r.current,assistantMessageId:S,userMessageId:_}),f.current=P?S:null,P)p({assistantMessageId:S,userMessageId:_,userMessage:e});else{var O="SEND_EMPTY_RESPONSE";A&&("ERROR"===N.status?O="SEND_SERVER_ERROR":"TIMEOUT"===N.status?O="SEND_SERVER_TIMEOUT":T.error?.graphQLErrors&&(O="SEND_GRAPHQL_ERROR")),v({threadId:M,messageId:S,message:N.content??void 0,...A?{status:"ERROR",error:O}:{status:N.status}})}}})}},[y,n,a,v,t]);s(()=>{if(!z){var e=setTimeout(()=>{if(g.assistantMessageId===f.current){var e=g?.userMessage,a=e?()=>K(e,{isResent:!0}):null;d(e=>e.map(e=>e.id!==g.assistantMessageId?e:rL(g.assistantMessageId,a??void 0))),aS({containerElement:r.current,assistantMessageId:g.assistantMessageId,userMessageId:g.userMessageId}),v({threadId:n,messageId:g.assistantMessageId,status:"ERROR",error:"POLL_TIMEOUT"}),p(null),f.current=null}},47e3);return()=>{clearTimeout(e)}}return()=>{}},[z,v,n,g?.assistantMessageId,g?.userMessage,g?.userMessageId,K]),e1(()=>{if(e&&!P&&!A){k?.nextMessageId&&I({messageId:k.nextMessageId,pauseQuery:!0});var a=k?.messages?.map(e=>tA(e)).filter(Boolean)||[];k?.nextMessageId||a.unshift(aA),d(a),m(a),setTimeout(()=>{r.current&&r.current.scroll({top:r.current.scrollHeight,behavior:"instant"})},0);var t=rO(a);if(t){f.current=t;var n=a[a.length-2];p({assistantMessageId:t,userMessageId:n&&"user"===n.sender?n.id:void 0,userMessage:null})}}},[e,k,P,A]),e1(()=>{if(e&&!D.fetching&&!D.error&&D.data?.messages?.length){I({messageId:D.data.nextMessageId??null,pauseQuery:!0});var a=D?.data?.messages?.map(e=>tA(e)).filter(Boolean)||[];if(D.data?.nextMessageId||a.unshift(aA),a.length){d(e=>a.concat(e)),m(a);var t=(r.current?.scrollHeight??0)-(r.current?.scrollTop??0);setTimeout(()=>{r.current&&r.current.scroll({top:(r.current?.scrollHeight??0)-t,behavior:"instant"})},0)}}},[e,D.fetching,D.error,D.data]),s(()=>{var e=null;if(!g||W||!f.current)return()=>clearTimeout(e);var a=x?.messages?.[0],t=!a||"TravelChatManager_AssistantMessage"!==a.__typename;if((H||t)&&Q.current<=3)return Q.current++,e=setTimeout(()=>{V({requestPolicy:"network-only"})},500),()=>clearTimeout(e);var{assistantMessageId:i,userMessage:s}=g,o=s?()=>K(s,{isResent:!0}):null;if(H?.networkError||t)return d(e=>e.map(e=>e.id!==i?e:rL(i,o??void 0))),aS({containerElement:r.current,assistantMessageId:i,userMessageId:g.userMessageId}),v({threadId:n,messageId:i,status:"ERROR",error:H?.networkError?"POLL_NETWORK_ERROR":"POLL_INVALID_RESPONSE"}),p(null),f.current=null,()=>clearTimeout(e);Q.current=0;var l={id:a.messageId,sender:"agent",responseData:a},c=rL(a.messageId,o??void 0),u="PENDING"===a.status,h=!u&&!a.content?.length||tP(a.status),T=h?c:{...l,isPending:u};if(d(e=>e.map(e=>e.id===i?T:e)),h||m([{...l,isPending:u}]),aS({containerElement:r.current,assistantMessageId:i}),u)e=setTimeout(()=>{V({requestPolicy:"network-only"})},500);else{var b="POLL_EMPTY_RESPONSE";h&&("ERROR"===a.status?b="POLL_SERVER_ERROR":"TIMEOUT"===a.status?b="POLL_SERVER_TIMEOUT":H?.graphQLErrors&&(b="POLL_GRAPHQL_ERROR")),v({threadId:n,messageId:i,message:a.content??void 0,...h?{status:"ERROR",error:b}:{status:a.status}}),p(null),f.current=null}return()=>clearTimeout(e)},[n,g,x,W,H,V,v,K]);var q=c(()=>{!S&&!C&&g&&n&&(a({itemType:"aitaMessagesPanel",actionSubType:"cancelPendingMessage",threadId:n,messageId:g.assistantMessageId}),_({threadId:n,messageId:g.assistantMessageId}).then(e=>{t({requestName:"cancelPending",error:e.error,hasData:!!e.data}),e.error||(f.current=null,p(null),d(e=>e.map(e=>e.id!==g.assistantMessageId?e:{sender:"agent",isCancel:!0,id:g.assistantMessageId,isPending:!1})),aS({containerElement:r.current,assistantMessageId:g.assistantMessageId,userMessageId:g.userMessageId}),v({threadId:n,messageId:g.assistantMessageId,status:"CANCELED"}))}))},[C,S,_,n,g,a,t,v]),G=!!b.messageId,Y=c(()=>{var t=!!r.current?.scrollTop&&r.current.scrollTop<200;e&&G&&t&&b.messageId&&b.pauseQuery&&!D.fetching&&(a({actionType:"scroll",itemType:"aitaMessagesPanel",actionSubType:"pageMessages",threadId:e}),I({messageId:b.messageId,pauseQuery:!1}))},[G,b,D.fetching,a,e]),j=c(()=>{r.current&&r.current.scroll({top:r.current.scrollHeight,behavior:"instant"})},[]);return{containerRef:r,fetching:P,error:A,reexcuteInitialMessagesQuery:O,reexcutePagedMessagesQuery:B,messages:l,currentThreadId:n,hasPendingMessage:!!rO(l),pagedMessagesError:D.error,addNewUserMessage:K,fetchingAddNewUserMessage:C,cancelPendingMessage:q,fetchingCancelPending:S,errorCancelPending:M,onScrollContainer:Y,scrollToBottom:j,mostRecentMessageResponse:h}},rB="UUbRM f u",rQ=e=>r("svg",{...e2(e),viewBox:"0 0 7 8",children:r("path",{d:"M3.49988 0.5C3.76072 2.30875 5.1912 3.73921 7 4.00008C5.19126 4.26095 3.76078 5.69133 3.49988 7.5C3.23901 5.69137 1.80866 4.26096 0 4C1.80868 3.73903 3.23904 2.30866 3.49988 0.5Z"})}),rz=({showText:e,text:a})=>t("div",{className:"MBkjX f u",children:[t("div",{className:"fNJxz f u Cj",children:[r("div",{className:eu(rB,"bQQya"),children:r(rQ,{size:7})}),r("div",{className:eu(rB,"DvZAA"),children:r(rQ,{size:7})}),r("div",{className:eu(rB,"jAGBb"),children:r(rQ,{size:7})})]}),e&&r(j,{atlasVariant:"fixed-body-20",color:"onSurfaceVariant",automationId:"aitaRecommendationsSearchInProgress",children:a||an.chat.loadingInitialResponse})]}),rx={message:"mnYlg z w f e",inlineStart:"BWiSl",inlineEnd:"OARkt",header:"nBnEO",footer:"w",messageContainer:"tYEZx z Zb Re",redBackground:"cbTzG",transparentBackground:"AEDGb",greenBackground:"AvYmN",saveButtonContainer:"wgFmf _m",fullWidth:"w"},rW=({header:e,children:a,footer:n,orientation:i="inlineStart",backgroundColor:s,saveButton:o,fullWidth:l=!1,...d})=>t("li",{className:ez(rx.message,{[rx.inlineStart]:"inlineStart"===i,[rx.inlineEnd]:"inlineStart"!==i}),children:[e?r("div",{className:rx.header,children:e}):null,t("div",{className:ez(rx.messageContainer,{[rx.redBackground]:"red"===s,[rx.transparentBackground]:"transparent"===s,[rx.greenBackground]:"green"===s,[rx.fullWidth]:l}),children:[o?r("div",{className:rx.saveButtonContainer,children:o}):null,r("div",{className:eW(d),children:a})]}),n?r("div",{className:rx.footer,children:n}):null]}),rH=({message:e,isFirstUserMessage:a,userAvatar:n,agentAvatar:i,backgroundColors:s,threadId:o})=>{var{isEnabled:l}=V(),d=e.id===rA,c="user"===e.sender,u=e.contents.map((a,t)=>{var o=`${e.id}-${t}`,l=c?n:i,d=c?s.user:s.agent,u=null;return"list"!==a.type&&(u=c||e.isPending?{paddingX:"spacing-03",paddingY:"spacing-02"}:{padding:["spacing-03","spacing-03","spacing-04"]}),r(aO,{fullWidth:"list"===a.type,footer:a.footer,header:0===t?l:null,orientation:c?"inlineEnd":"inlineStart",backgroundColor:a.backgroundColor??d,saveButton:a.saveButton,...u,children:a.content},o)});return t("ul",{[rN]:e.id,children:[e.isPending?r("li",{children:r(rz,{showText:a,text:e.intermediateThought})}):null,u,!l||c||d?null:r(e0,{children:r(g,{children:r(aL,{threadId:o||"thread not started yet",messageId:e.id,orientation:"inlineStart"})})})]})},rV=({prompts:e,onPromptClick:a})=>{var n=O({itemType:"aitaPrompts",arrayQuestionIds:e.map(e=>e.id??null)}),i=c((e,t)=>{a(e,t)},[a]);return 0===e.length?null:r("div",{ref:n,className:"ELIAc","aria-label":an.chat.ariaPromptsList,role:"region",children:e.map((e,a)=>r("div",{className:"aogaM",children:r(q,{variant:"gai",size:"small",onClick:()=>i(e,a),...eb("aitaDynamicPrompt"),children:t("span",{className:"f G u Wh",children:[r("span",{className:"I",children:r(e4,{size:20,marginRight:"spacing-01"})}),e.text]})})},e.text))})},rK=({hideScrollButton:e,onClick:a})=>e?null:r("div",{className:"upLEx D _s Rb Za",children:r(G,{variant:"primary-border",size:"small",icon:eh,onClick:a,"aria-label":an.chat.scrollDown})});function rq(e){var a=u(null),t=u(!1),{os:r}=e3(),n="IOS"===r.family;return s(()=>{var r,i,s=e.current,o=a.current;if(n&&s&&o){var l=e=>{if(!t.current&&window.visualViewport){e.preventDefault(),t.current=!0,o.focus({preventScroll:!0});var a=()=>{window.visualViewport&&window.innerHeight-window.visualViewport.height>100&&(r&&(clearTimeout(r),r=void 0),window.visualViewport?.removeEventListener("resize",a),i=void 0,s.focus({preventScroll:!0}),t.current=!1)};i=a,window.visualViewport?.addEventListener("resize",a),r=setTimeout(()=>{i&&(window.visualViewport?.removeEventListener("resize",i),i=void 0),s.focus({preventScroll:!0}),t.current=!1,r=void 0},500)}};return s.addEventListener("focus",l,!0),()=>{s.removeEventListener("focus",l,!0),r&&clearTimeout(r),i&&window.visualViewport?.removeEventListener("resize",i),t.current&&(t.current=!1)}}},[e,n]),a}var rG="ZVkDM Cq Wb",rY=()=>{var{privacyPolicy:e,termsOfUse:a}=e9(),t=e6();return r("div",{className:"eJfmT Gm Re c",children:r(j,{atlasVariant:"fixed-body-10",color:"onSurface",children:r(er,{id:"ai_assistant_legal_disclaimer_v3",args:{termsLinkAttributes:`href="${a}" target="_blank" class="${rG}"`,privacyLinkAttributes:`href="${e}" target="_blank" class="${rG}"`,howTheSiteWorksLinkAttributes:`href="${t}" target="_blank" class="${rG}"`},messages:"AI-generated; may contain inaccuracies. Don't share personal data. See <a {termsLinkAttributes}>Terms</a>, <a {privacyLinkAttributes}>Privacy &amp; Cookies Statement</a>, and <a {howTheSiteWorksLinkAttributes}>How Ollie Works</a>."})})})},rj=e=>({content:t("div",{children:[r(rf,{}),!!e&&r("div",{children:r(Y,{onClick:e,type:"button",children:an.chat.retrySendMessageCta})})]}),backgroundColor:"red"}),rF={__key:0xbcb404bb2efd,id:"bcb404bb2efd42c2",loc:{},definitions:[]},rU=(e,a)=>{var t=o(()=>{var a=new Set,t=new Map;return e.forEach(e=>{var r=e?.details?.locationV2?.tags?.tags?.map(e=>e?.tagId&&11066!==e.tagId?e.tagId:null)?.filter(Boolean)?.slice(0,2)||[],n=[...e?.details?.locationV2?.tags?.tags?.find(e=>e?.tagId===11066)?[11066]:[],...r];e?.details?.locationId&&(t.set(e.details.locationId,n),n.forEach(e=>a.add(e)))}),{allLocationTags:a,locationTagIdsMap:t}},[e]),[{data:r,fetching:n}]=X({query:rF,variables:{tagIds:[...t.allLocationTags]},pause:!t.allLocationTags.size||a}),i=r?.getTagInformation;return{allLocationTagsInfoMap:o(()=>{var a=new Map;return e.forEach(e=>{if(e?.details?.locationId){var r=t.locationTagIdsMap.get(e.details.locationId)?.map(e=>{var a=i?.find(a=>a?.tagId===e);return a?{localizedName:a.localizedName,categoryId:a.categoryId,tagId:a.tagId}:null}).filter(Boolean)||[];a.set(e?.details?.locationId,r)}}),a},[e,i,t.locationTagIdsMap]),isTagInfoFetching:n}},rZ=({initialThreadId:e,onSelectThread:a,initialUserMessage:l,onClose:d,onOpenThreadsPanel:c,createNewThread:u,onHasResponse:h,prompts:m})=>{var g=w(),{login:p}=L(),f=!!D(),T=K(),{openToast:v}=a0(),[b,E]=i(new Map),{containerRef:I,messages:C,mostRecentMessageResponse:N,currentThreadId:_,hasPendingMessage:S,pagedMessagesError:M,addNewUserMessage:R,fetchingAddNewUserMessage:A,cancelPendingMessage:O,fetchingCancelPending:B,errorCancelPending:Q,fetching:z,error:x,reexcuteInitialMessagesQuery:W,reexcutePagedMessagesQuery:H,onScrollContainer:V,scrollToBottom:q}=aw({initialThreadId:e}),{allLocationTagsInfoMap:G}=rU(o(()=>tk(N),[N]),S);return(s(()=>{C.length>2&&h?.()},[h,C]),s(()=>{S||E(e=>{var a=new Map(e);return G?.forEach((e,t)=>a.set(t,e)),a})},[G,E,S]),s(()=>{l?.text&&!z&&R(l)},[l,R,z]),s(()=>{Q&&v({textContent:an.chat.canceledMessageError,variant:"error",icon:"error"})},[v,Q]),s(()=>{a(_||null)},[_,a]),z)?r(P,{onClose:d,onOpenThreadsPanel:c,createNewThread:u}):x?t(n,{children:[r(k,{onClose:d,onOpenThreadsPanel:c,createNewThread:u}),r(y,{errorBody:an.panel.errorBody,buttonSize:"medium",retry:W,retryButtonTitle:an.panel.errorCta,isFullScreen:!0})]}):r(aH,{ref:I,messages:C,prompts:m,isLoading:A||B,showCancelPendingButton:S,onSubmitMessage:e=>{g({itemType:"aitaMessagesPanel",actionSubType:"clickToInitiateQuery",promptScrollDepth:e.promptScrollDepth,promptType:e.promptType,threadType:_?"EXISTING":"NEW",messageType:e.type,messageOrigin:"MESSAGES_PANEL",textLength:e.text.length}),f?R(e):p({flowOrigin:"login",extraQueryParams:{contextualMessage:"ask_ollie_login_gate_header"},onClose:()=>{g({itemType:"aitaMessagesPanel",actionSubType:"cancelLoginFlow",entryPointType:e.type,promptType:e.promptType,messageOrigin:"MESSAGES_PANEL"})},onSuccess:a=>{a.userId&&R(e,{userId:a.userId,preLoginGateState:a.hasCreatedMember?"NOT_REGISTERED":"LOGGED_OUT"})}})},onCancelPendingMessage:O,onScroll:V,onScrollToBottom:q,backgroundColors:{user:"green"},onClose:d,onOpenThreadsPanel:c,createNewThread:u,pagedMessagesError:!!M,onTryLoadMore:H,threadId:_,tagsInfoMap:b,isMapViewExperimentEnabled:T.enabled})},rX=e=>e?.TravelChatManager_getThreadHeaders?.threads?.map(e=>{if(!e)return null;var{threadId:a,updatedAt:t,title:r,active:n}=e,i=new Date(t);return!r||isNaN(i.getTime())?null:{threadId:a,updatedAt:i,title:r,active:n}}).filter(Boolean)||[],r$=({isSelected:e,threadId:a,title:n,onThreadClick:i,onDeleteThread:s})=>{var o="DESKTOP"===ep();return t("div",{className:eu("smQnc z w k Ph PN Pu PA",{Tmmzm:e}),children:[r("button",{type:"button",onClick:()=>i(a),className:"rNDha H _S _G Hn B- C-","data-thread-id":a,children:r(j,{atlasVariant:"fixed-body-30",color:"onSurface",lineClamp:1,children:n})}),r("div",{className:"LBkfM",children:r(G,{onClick:()=>s(a),variant:o?"dark":"clear",icon:aa,"aria-label":an.threads.deleteSessionButtonAriaLabel(n),size:"small",...eb("aitaDeleteThread")})})]})},rJ={threadPanel:"eIVvQ _Z f e",horizontalMargins:"NO Nm",header:"XBCOu f k",threadPanelScroll:"CULaQ MK",newChatContainer:"UcvOV",newThreadButton:"orUOn w Ph PV Pu PA f u",threadsGroup:"SxCln",threadsGroupHeader:"yUDiM t Z1",resetButtonStyles:"SUdPB _S _G Hn B- C-"},r0=({onClose:e})=>t("div",{className:eu(rJ.header,rJ.horizontalMargins),children:[r(j,{atlasVariant:"fixed-title-20",elementType:"h2",color:"onSurface",children:an.threads.title}),r(G,{onClick:e,icon:eo,"aria-label":an.threads.closeButtonAriaLabel,size:"small",automationId:"aitaCloseThreadsPanel"})]}),r1=()=>r("div",{className:"lArbl _Q X0 X1",children:r(eg,{variant:"large"})}),r2=({selectedThreadId:e,onThreadClick:a,createNewThread:o,onClose:l,initialThreadHeadersInfo:d})=>{var h=w(),{deleteThreads:m,state:g}=tr(),p=E(),f=u(null),[T,v]=i({threadId:null,pauseQuery:!0}),[b,I]=i([]),{openToast:C}=a0(),{fetching:_,error:S,data:M,reexcuteQuery:R}=d,k=T.pauseQuery||!T.threadId,[{fetching:P,error:A,data:O},L]=tt({threadId:T.threadId??void 0,limit:30},k);N({requestName:"getThreadHeaders",fetching:P,error:A,isQueryPaused:k,hasData:!!O}),s(()=>{if(!_&&!S&&M?.TravelChatManager_getThreadHeaders){I(aK(M));var{nextThreadId:e}=M.TravelChatManager_getThreadHeaders;e&&v({threadId:e,pauseQuery:!0})}},[_,S,M]),s(()=>{if(!P&&!A&&O?.TravelChatManager_getThreadHeaders){var e=aK(O);if(e.length){I(a=>a.concat(e));var{nextThreadId:a}=O.TravelChatManager_getThreadHeaders;a&&v({threadId:a,pauseQuery:!0})}}},[P,A,O]);var D=c(()=>{if(null!==f.current){var e=f.current,a=e.scrollHeight-(e.scrollTop+e.getBoundingClientRect().height);T.threadId&&a<200&&!P&&(h({actionType:"scroll",itemType:"aitaThreadsPanel",actionSubType:"pageThreads"}),v(e=>({...e,pauseQuery:!1})))}},[T.threadId,P,h]);return _?t(n,{children:[r(r0,{onClose:l}),r(aj,{})]}):S?t(n,{children:[r(r0,{onClose:l}),r(y,{errorBody:an.panel.errorBody,buttonSize:"medium",retry:R,retryButtonTitle:an.panel.errorCta,isFullScreen:!0})]}):r(aY,{ref:f,selectedThreadId:e,onScroll:D,threads:b,pagedThreadsError:!!A,onThreadClick:e=>{h({itemType:"aitaThreadsPanel",actionSubType:"openExistingThread",threadId:e}),a(e)},createNewThread:()=>{h({itemType:"aitaThreadsPanel",actionSubType:"openNewThread",lastOpenedThreadId:e}),o()},onDeleteThread:a=>{g.fetching||(h({itemType:"aitaThreadsPanel",actionSubType:"deleteThread",threadId:a}),m(a).then(t=>{p({requestName:"deleteThreads",error:t.error,hasData:!!t.data}),t.error?C({textContent:an.threads.sessionDeletedError,variant:"error",icon:"error"}):(R(),e===a&&o(!0),C({textContent:an.threads.sessionDeleted,variant:"primary",icon:"success",isDurationLong:!0}))}))},onTryLoadMore:L,onClose:l})},r4=({selectedThreadId:e,onThreadClick:a,createNewThread:n,onClose:i,isOpen:s,initialThreadHeadersInfo:o})=>{var{isClosed:l,slideOut:d}=A({isOpen:s,transitionDuration:250});return l?null:r(e7,{children:t("div",{className:eu({vNEuT:d}),children:[r("div",{className:"suJWM _Q t s l _U Gi",onPointerDown:i}),r("div",{className:"WXoky _Q t s l _U _s o Gi",children:r(aF,{selectedThreadId:e??void 0,onThreadClick:a,createNewThread:n,onClose:i,initialThreadHeadersInfo:o})})]})})},r3=()=>{var e=!D(),[{fetching:a,error:t,data:r},n]=tt({limit:45},e);return N({requestName:"getThreadHeaders",fetching:a,error:t,isQueryPaused:e,hasData:!!r}),o(()=>{var e=a||t?void 0:r?.TravelChatManager_getThreadHeaders?.threads?.find(e=>!!e?.active);return{initialThreadHeadersFetching:a,initialThreadHeadersError:t,initialThreadHeadersData:r,reexcuteInitialThreadsQuery:n,activeThread:e}},[a,t,r,n])},r6=({onSelectThread:e,onHasResponse:a,initialUserMessage:o,onClose:l,prompts:d,isPromptsLoading:c})=>{var u=w(),{login:h}=L(),m=!!D(),[g,p]=i(void 0),[f,T]=i(!0),[v,b]=i(!1),[E,I]=i(void 0),[C,N]=i(!1),{activeThread:_,initialThreadHeadersFetching:S,initialThreadHeadersError:M,initialThreadHeadersData:R,reexcuteInitialThreadsQuery:A}=aZ();s(()=>{if(!S&&!C){var e;_?.threadId&&!o&&(e=_?.threadId,T(!1),p(_.threadId),I(_?.threadId?_.threadId:`TMP-KEY-PROP-${Math.random()}`)),u({actionType:"other",itemType:"aitaMessagesPanel",...void 0===e?{actionSubType:"autoOpenNewThread"}:{actionSubType:"autoOpenExistingThread",threadId:e}}),N(!0)}},[_,S,p,I,e,o,C,u]);var O=(e,a)=>{T(!1),b(a??!1),e&&e===g||(p(e),I(e||`TMP-KEY-PROP-${Math.random()}`))},B=()=>{u({itemType:"aitaMessagesPanel",actionSubType:"openNewThread",lastOpenedThreadId:g}),O()},Q=e=>{u({itemType:"aitaMessagesPanel",actionSubType:"openThreadsPanel",lastOpenedThreadId:g,preLoginGateState:e}),A?.(),b(!0)},z=()=>{u({itemType:"aitaMessagesPanel",actionSubType:"clickToOpenThreadsPanel",lastOpenedThreadId:g}),m?Q("LOGGED_IN"):h({flowOrigin:"login",extraQueryParams:{contextualMessage:"ask_ollie_login_gate_header"},onClose:()=>{u({itemType:"aitaMessagesPanel",actionSubType:"cancelLoginFlow",entryPointType:"OPEN_THREADS_PANEL_CTA",messageOrigin:"MESSAGES_PANEL"})},onSuccess:e=>Q(e.hasCreatedMember?"NOT_REGISTERED":"LOGGED_OUT")})},x=!C||c,W=x?r(P,{onClose:l,onOpenThreadsPanel:z,createNewThread:B}):null,H=M?t(n,{children:[r(k,{onClose:l,onOpenThreadsPanel:z,createNewThread:B}),r(y,{errorBody:an.panel.errorBody,buttonSize:"medium",retry:A,retryButtonTitle:an.panel.errorCta,isFullScreen:!0})]}):null;return t("div",{className:"_Q t s l _U",children:[r("div",{className:"imuyB _Z Gm",children:x||M?t(n,{children:[W,H]}):r(aV,{initialThreadId:g??void 0,onSelectThread:e,initialUserMessage:f?o:void 0,onClose:l,onOpenThreadsPanel:z,createNewThread:B,onHasResponse:a,prompts:d},E)}),r(aU,{selectedThreadId:g,isOpen:v,onThreadClick:O,createNewThread:e=>O(void 0,e),onClose:()=>b(!1),initialThreadHeadersInfo:{fetching:S,error:!!M,data:R,reexcuteQuery:()=>A?.()}})]})},r9=e=>r(ar,{children:r(r6,{...e})});return e("useIOSFocusProxy",rq),[()=>{at=l({openToast(){throw Error("Missing 'openToast' in ChatPanelsToastContext")}}),ar=aJ,an=H({header:{closeButtonAriaLabel:"Minimize AI assistant"},chat:{welcomeMessage:"I'm Ollie, your AI travel companion! I scan English-language reviews, forum posts, and recommendations for wisdom that'll help your trip take flight. Some questions you can ask me:",welcomeHeading:"Hello! \uD83D\uDC4B ",canceledMessage:"Your message was canceled—I didn’t see a thing! \uD83E\uDEE3",canceledMessageError:"I couldn’t cancel that message, sorry about that.",errorMessages:["Seems like I ran into a bit of a hiccup—sorry about that! Mind asking your question again?","Oops—I got a little tangled up looking for your answer. Can you repeat it for me?","I got a little mixed up looking for your answer—sorry! Want to try again? I'm right here when you're ready.","Whelp, I think there's a problem on my end—my mistake. Can you ask your question again?","Uh oh...flew a little too fast and hit a snag on my search. Can you ask me one more time?","Whoops! Looks like I hit a bit of turbulence fetching an answer. Try asking it again."],sourcesErrorBody:"Got a little mixed up while grabbing content for you—sorry!",sourcesErrorCta:"Try again",showSources:"Show sources",showSource:"Show source",hideSources:"Hide sources",hideSource:"Hide source",seeFullForumPost:"See full forum post",loadingInitialResponse:"Hang tight while I dive into our traveler recommendations and reviews...",ariaLoadingResponse:"The AI assistant is generating a response",ariaPromptsList:"Examples of questions you can ask the AI assistant about this place",moreMessagesErrorBody:"There was a problem retrieving older messages.",moreMessagesErrorCta:"Try again",retrySendMessageCta:"Try again",map:"Map",list:"List",scrollDown:"Scroll down"},threads:{title:"Previous sessions",newThread:"Start a new session",today:"Today",yesterday:"Yesterday",lastWeek:"Last Week",lastMonth:"Last Month",older:"Older",sessionDeleted:"Session deleted. Items saved to Trips are still available.",sessionDeletedError:"Session was not deleted. Please try again.",deleteSessionButtonAriaLabel:e=>`Delete session titled ${e}`,closeButtonAriaLabel:"Close session history",moreThreadsErrorTitle:"Oops!",moreThreadsErrorBody:"There was a problem retrieving older chats.",moreThreadsErrorCta:"Try again"},panel:{errorBody:"Got a little mixed up while grabbing content for you—sorry! ",errorCta:"Let’s try that again"},feedback:{voteThumbsUpAriaLabel:"Give this response a thumbs up",voteThumbsDownAriaLabel:"Give this response a thumbs down",votedThumbsUpAriaLabel:"You gave this response a thumbs up",votedThumbsDownAriaLabel:"You gave this response a thumbs down",closeAriaLabel:"Close feedback form",thumbsDownTitle:"What was the primary issue with this response?",thanksGood:"Thanks for your feedback!",thanksBad:"Thanks. Your feedback is valuable as we continue to improve our responses.",submitButton:"Submit",inputAriaLabel:"Add your comments",feedbackPlaceholder:"Add your comments",error:"Something went wrong while submitting your feedback. Please try again.",options:{NOT_FACTUAL:"Factually incorrect",LOW_QUALITY:"Low-quality recommendation",MISSING_DETAILS:"Missing key details",REFUSE_TO_ANSWER:"Refused to respond",ERROR:"Error or bug",INAPPROPRIATE:"Inappropriate",OTHER:"Other"}}}),ai=H([244,283,635,636]),as=f.message,ao=an.feedback.options,al=td,ad=tc,ac=tp,au=tf,ah=f.source,am=tv,ag=tw,ap=tB,af=h(function({location:e,locationReviewSummary:a,onSaveClick:i,onSaveComplete:s,onNameLinkClick:o,tagsInfo:l},d){if(!e)return null;e.isGeo||a?.responseData?.rating==null||a?.responseData?.count==null||(c={rating:a.responseData.rating,reviewCount:a.responseData.count});var c,u=t(n,{children:[r("div",{className:tU.imageContainer,children:r(eL,{roundingSize:"none",action:r(Z,{id:e.locationId||void 0,variant:"primary",bookmarkStyle:"circular-button",size:"small",saveSourceOrigin:"AI_TRAVEL_ASSISTANT",onClick:i,onSaveComplete:s}),award:e.locationV2?.bestAwardForActiveYearV2?.awardType&&r(eO,{size:"small",color:e.locationV2?.bestAwardForActiveYearV2?.awardType==="BOTB"?"yellow":"green",year:e.locationV2?.bestAwardForActiveYearV2?.year??void 0}),children:r(ew,{source:e.thumbnail?.photoSizeDynamic,aspectRatio:"1:1",roundingSize:"none"})})}),t("div",{className:tU.info,children:[r(j,{lineClamp:1,atlasVariant:"fixed-title-10",color:"onSurface",children:e.name}),c?r(eE,{size:"small",showRating:!1,rating:c.rating,reviewCount:c.reviewCount}):null,r(tK,{location:e,tagsInfo:l})]})]});return r("div",{className:tU.container,ref:d,children:e.route?.url?r("a",{href:e.route?.url,target:"_blank","aria-label":e.name||void 0,className:tU.card,onClick:o,children:u}):r("div",{className:tU.card,children:u})})}),aT=h(function({index:e,threadId:a,messageId:t,location:n,locationReviewSummary:i,tagsInfo:s},o){var l=D(),d=n?.locationId,c={itemType:"aitaLocationCard",threadId:a,messageId:t,itemId:`${d}`,isBookableAttractionProduct:n?.locationV2?.details?.__typename==="LocationSelection_AttractionProductDetails"&&n?.locationV2?.details?.productDetails?.pricingInfo!=null,viewType:"MAP"},u=O({...c,saveable:!0}),h=w();return r("div",{ref:u,children:r(af,{ref:o,location:n,locationReviewSummary:i,onSaveClick:()=>{h({...c,actionSubType:"clickSaveButton"})},onSaveComplete:(e,a,t)=>{h({...c,actionSubType:"saveLocationToTrip",tripId:t,tripSaveType:a}),_(l)},onNameLinkClick:()=>h({...c,actionSubType:"openLocationDetails",mapScrollDepth:e}),tagsInfo:s})})}),av=tX,ab=t$,aE=m(t4),aI=H({top:50,bottom:200,left:50,right:50}),ay=t9,aC=ro,aN=rl,a_=rc,aS=rS,aM=new eJ({counterName:"aita_settled_assistant_messages",metricName:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfMsBjIrNTP4r5BEJAs0VsuLUnNcQdwhjILfFMlgHmuM58+xn2VyWCLzsaeHqyRe7Wc=",version:0,additionalLabels:["EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfPxmZLu0jLhWLMWnbfGiORfzkrzP74zL0vyAgCO1NCdfQ9Tc475vtE/NazR07eMROg="],labelHooks:[]},{status:["SEND_NETWORK_ERROR","SEND_INVALID_RESPONSE","SEND_EMPTY_RESPONSE","SEND_GRAPHQL_ERROR","SEND_TIMEOUT","SEND_SERVER_ERROR","SEND_SERVER_TIMEOUT","ANOTHER_PROMPT_PENDING","INAPPROPRIATE_PROMPT","CANCELED","POLL_NETWORK_ERROR","POLL_INVALID_RESPONSE","POLL_EMPTY_RESPONSE","POLL_GRAPHQL_ERROR","POLL_TIMEOUT","POLL_SERVER_ERROR","POLL_SERVER_TIMEOUT","COMPLETE"],hasLatency:["yes","no"],package:["@ta/ai-travel-assistant.panel"]}),aR=new eJ({counterName:"aita_settled_assistant_messages_latency",metricName:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfM4geQOE77ZFE1XgCknxHf/ttXQE9ORcW8cCRbpzdoLKg==",version:0,additionalLabels:["EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfM6bgh9aLdhPHrXgfSxTCnyNHKqS+laxZiJHQ+fz7KkbtoiqUiHsobyFt0F4GGVwUY="],labelHooks:[]},{status:["SEND_NETWORK_ERROR","SEND_INVALID_RESPONSE","SEND_EMPTY_RESPONSE","SEND_GRAPHQL_ERROR","SEND_TIMEOUT","SEND_SERVER_ERROR","SEND_SERVER_TIMEOUT","ANOTHER_PROMPT_PENDING","INAPPROPRIATE_PROMPT","CANCELED","POLL_NETWORK_ERROR","POLL_INVALID_RESPONSE","POLL_EMPTY_RESPONSE","POLL_GRAPHQL_ERROR","POLL_TIMEOUT","POLL_SERVER_ERROR","POLL_SERVER_TIMEOUT","COMPLETE"],package:["@ta/ai-travel-assistant.panel"]}),ak=H({CANCELED:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNuYgVFD0vwpxNxBDvY9JjqCdfZmHIBk+Qz4C5Fu2JTGw==",COMPLETE:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfMZ+Fb2B+qz943QVCT0feyX1qVrYhs/lUMOfI/ZmwWjnw==",INAPPROPRIATE_PROMPT:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfPF9kphaQ2wKDwGam8WBKicetTQLjYaS7Ltak5oTLJsjg==",SEND_NETWORK_ERROR:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfPo7QTLDkC22NMQGm2arByZiiXF3XtuyW9BNIwXNEQ1GQ==",SEND_INVALID_RESPONSE:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfMzknTUORgKNkFSVmA6be/YFI0N7D+zPmtfJPKWa4hQEg==",SEND_EMPTY_RESPONSE:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfMi06pJTRiUVdgwYjN/sN0BUCkhOqpDA7pQchPwg5cACw==",SEND_GRAPHQL_ERROR:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfNnpm1u4F02i9/fwjPgOsWTrXJy0rYWmMpQUFNyRPuhCw==",SEND_TIMEOUT:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfOi896zijPg/tNKbH4v/RhJCyzRIW3cdIow+FSrtA8oCA==",SEND_SERVER_ERROR:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfN9q+OhE5qVNNRyt100X4yhLolrAOkQn7iJn0YK4NAWAQ==",SEND_SERVER_TIMEOUT:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfN9q+OhE5qVNNRyt100X4yhBxY7WEVbmf0z71v1hxpiPA==",ANOTHER_PROMPT_PENDING:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfPCNTYWzirITkmR00fIFh8v47k5I2pkTncKM0HIR+Jo3A==",POLL_NETWORK_ERROR:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfPcdCrH+GupkAHMNsjCyXBRA7zpHa/gA9ik0vKzgqC7bw==",POLL_INVALID_RESPONSE:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfM24HZ9ETPTckzdVak33nyQ/ZT3+ceVjS1HRh8YDyt89A==",POLL_EMPTY_RESPONSE:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfMZ/6A8nFeV9BPOoIPNgWPqa89mwmzWpAWSz9MjVpvOZw==",POLL_GRAPHQL_ERROR:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfPrBsP7gR51bjvFez96bwzPXtldXAO4FMaefz9Buci3Nw==",POLL_TIMEOUT:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfMF08RXxUirJCKe4d6fGA/CXewAUHaucWsw87k4hPvBlA==",POLL_SERVER_ERROR:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfMpIt6xP7u2l2WK4BBvM0AbcFLJRGIGm724NhrrISOQhg==",POLL_SERVER_TIMEOUT:"EKo+nCQzQkK3QA4lB9jcWaTfYEqihHNA6+sWblM0TfMpIt6xP7u2l2WK4BBvM0AbfcFYtgWu+llpAvt1FkXjhw=="}),aP=rP,aA=H({sender:"agent",id:rA,rawHeading:an.chat.welcomeHeading,rawMessage:an.chat.welcomeMessage}),aw=rD,aO=rW,aL=p(()=>a("vol5tk")),aD=rH,aB=rV,aQ=rK,az=h(function({onScroll:e,onScrollToBottomClick:a,children:n},s){var[o,l]=i(!0),d=c(a=>{a?.currentTarget?.scrollHeight-a?.currentTarget?.offsetHeight-a?.currentTarget?.scrollTop<=20?l(!0):l(!1),e?.()},[e]);return t("div",{className:"zexsO _T Gm z _g",ref:s,onScroll:d,children:[n,r(aQ,{onClick:a,hideScrollButton:o})]})}),ax=h(function({prompts:e,onSubmitMessage:a,isLoading:n,showCancelPendingButton:s,onCancelPendingMessage:o,onScroll:l,onScrollToBottom:d,isNewConversation:h,children:m},g){var p=ep(),f=u(null),T=rq(f),[v,b]=i(!1),E=c((e,t)=>{a({text:e.text,type:"PROMPT",origin:"MESSAGES_PANEL",promptType:e.type,promptScrollDepth:t})},[a]),I=c(()=>{if(f.current){var e=parseInt(getComputedStyle(f.current).lineHeight.replace("px",""),10),a=("MOBILE"===p?6:3)*e;f.current.style.height="0px";var{scrollHeight:t}=f.current;f.current.style.height=`${Math.min(0===t?e:t,a)}px`,b(t>e)}},[p]),y=c(()=>{d?.(),"DESKTOP"===p&&f?.current?.focus()},[d,p]);return t("div",{className:"LyyTR",children:[r("textarea",{ref:T,tabIndex:-1,"aria-hidden":"true",className:"XGwZj t l Y S"}),r(az,{ref:g,onScroll:l,onScrollToBottomClick:y,children:t("div",{className:"GWZcH e",children:[m,h&&r(aB,{prompts:e,onPromptClick:E})]})}),r("div",{className:"TvjzB s l w",children:r("div",{className:"FRJtu Pj PX Pw PJ",children:"MOBILE"===p?r(M,{ref:f,onSubmitMessage:e=>a({text:e,type:"FREE_TEXT",origin:"MESSAGES_PANEL"}),isLoading:n,showCancelPendingButton:s,onCancelPendingMessage:o,updateInputSize:I,inputHasMultipleLines:v}):r(R,{ref:f,autoFocus:"DESKTOP"===p,onSubmitMessage:e=>a({text:e,type:"FREE_TEXT",origin:"MESSAGES_PANEL"}),isLoading:n,showCancelPendingButton:s,onCancelPendingMessage:o,updateInputSize:I,inputHasMultipleLines:v})})})]})}),aW=rY,aH=h(function({messages:e,prompts:a,userAvatar:i,agentAvatar:s,onSubmitMessage:l,isLoading:d,showCancelPendingButton:c,onCancelPendingMessage:u,onScroll:h,onScrollToBottom:m,backgroundColors:g,onClose:p,onOpenThreadsPanel:f,createNewThread:T,pagedMessagesError:v,onTryLoadMore:b,threadId:E,tagsInfoMap:I,isMapViewExperimentEnabled:C},N){var _=o(()=>1===e.filter(e=>"user"===e.sender).length,[e]),S=o(()=>e.every(e=>"user"!==e.sender),[e]),M=o(()=>e.map(e=>{var a,i=[];if("user"===e.sender){var s=e?.responseData?.__typename==="TravelChatManager_UserMessage"?e.responseData.messageContent?.text:null,o=e.rawMessage??s;o&&i.push({type:"text",content:r(rm,{children:o})})}else{var l=[];if(e?.responseData?.__typename==="TravelChatManager_AssistantMessage"){var d=ry({threadId:e.responseData.threadId,messageId:e.responseData.messageId,status:e.responseData.status,content:e.responseData.content,resolvedGeoIds:e.responseData.resolvedGeoIds,feedbackRating:e.responseData.feedbackRating,isMapViewEnabled:C,tagsInfoMap:I});l=d.contents?[...d.contents]:l,a=e.responseData.intermediateThought??void 0}else e.isError?l.push(rj(e.refetch)):e.isCancel?l.push({content:r(rg,{})}):e.rawMessage&&l.push({content:t(n,{children:[e.rawHeading?r(j,{atlasVariant:"fixed-label-30",children:e.rawHeading}):null,r(rm,{children:e.rawMessage})]})});i.push(...l)}return{id:e.id,sender:e.sender,isPending:e.isPending,intermediateThought:a,contents:i}}),[I,e,C]);return t(ax,{ref:N,prompts:a,onSubmitMessage:l,isLoading:d,showCancelPendingButton:c,onCancelPendingMessage:u,onScroll:h,onScrollToBottom:m,isNewConversation:S,children:[r(k,{onClose:p,onOpenThreadsPanel:f,createNewThread:T}),r(aW,{}),v&&r(y,{errorBody:an.chat.moreMessagesErrorBody,retry:b,retryButtonTitle:an.chat.moreMessagesErrorCta}),M.map(e=>r(aD,{isFirstUserMessage:_,message:e,userAvatar:i,agentAvatar:s,backgroundColors:g,threadId:E},e.id))]})}),aV=rZ,aK=rX,aq=r$,aG=H({today:an.threads.today,yesterday:an.threads.yesterday,lastWeek:an.threads.lastWeek,lastMonth:an.threads.lastMonth,older:an.threads.older}),aY=h(function({selectedThreadId:e,threads:a,pagedThreadsError:n,onThreadClick:i,createNewThread:l,onDeleteThread:d,onTryLoadMore:c,onScroll:h,onClose:m},g){var p=u(null);s(()=>{p.current?.focus()},[]);var f=e8(),T=o(()=>{var e=ae(f,-1),t=ae(e,-5),r=ae(t,-23),n={today:[],yesterday:[],lastWeek:[],lastMonth:[],older:[]};return a.forEach(a=>{a.updatedAt>=f?n.today.push(a):a.updatedAt>=e?n.yesterday.push(a):a.updatedAt>=t?n.lastWeek.push(a):a.updatedAt>=r?n.lastMonth.push(a):n.older.push(a)}),n},[a,f]);return t("div",{className:rJ.threadPanel,children:[r(r0,{onClose:m}),r("div",{className:eu(rJ.newChatContainer,rJ.horizontalMargins),children:t("button",{ref:p,onClick:l,type:"button",className:eu(rJ.resetButtonStyles,rJ.newThreadButton),...eb("aitaStartNewSession"),children:[r(e5,{size:24}),r(j,{elementType:"span",atlasVariant:"fixed-label-30",children:an.threads.newThread})]})}),t("div",{className:eu(rJ.threadPanelScroll,rJ.horizontalMargins),ref:g,onScroll:h,children:[Object.keys(aG).map(a=>T[a].length>0&&t("div",{className:rJ.threadsGroup,...eb("aitaHistoryCategory"),children:[t("div",{className:rJ.threadsGroupHeader,children:[r(j,{atlasVariant:"fixed-label-30",color:"onSurfaceVariant",elementType:"h3",children:aG[a]}),r("div",{"aria-hidden":!0,children:r(eX,{marginTop:"spacing-01",marginBottom:"spacing-01"})})]}),T[a].map(a=>r(aq,{isSelected:a.threadId===e,threadId:a.threadId,title:a.title,onThreadClick:i,onDeleteThread:d},a.threadId))]},a)),n&&r(y,{errorTitle:an.threads.moreThreadsErrorTitle,errorBody:an.threads.moreThreadsErrorBody,retry:c,retryButtonTitle:an.threads.moreThreadsErrorCta})]})]})}),aj=r1,aF=r2,aU=r4,aZ=r3,e({default:r9,useIOSFocusProxy:rq})},[e=>(t=e.jsxs,r=e.jsx,n=e.Fragment),e=>(i=e.useState,s=e.useEffect,o=e.useMemo,l=e.createContext,d=e.useContext,c=e.useCallback,u=e.useRef,h=e.forwardRef,m=e.memo,g=e.Suspense,p=e.lazy),e=>(f=e.StasisRequestCounterComponent,T=e.usePageContext,v=e.StasisRequestCounter,b=e.StasisService,E=e.useConstantIncrementGraphqlRequestCounterCallback,I=e.useHorizontalScrollButtonsState,y=e.PanelErrorUI,C=e.ChatHorizontalScrollButtons,N=e.useIsomorphicGraphqlRequestCounter,_=e.onUserSaveToTripViaAiAssistant,S=e.ErrorBoundaryCounter,M=e.BottomSheetChatInput,R=e.ChatInputControlled,k=e.MessagesPanelHeader,P=e.LoadingMessagesPanel,A=e.useModalVisibility),e=>(w=e.useAitaInteractionLogger,O=e.useAitaImpressionLoggerRef),e=>L=e.default,e=>D=e.useUserId,e=>B=e.default,e=>Q=e.default,e=>z=e.default,e=>x=e.default,e=>W=e.ToastItem,e=>H=e.readOnly,e=>(V=e.useAlphaExperiment,K=e.useMapViewExperiment),e=>(q=e.default,G=e.CircularButton,Y=e.ButtonBorderless),e=>j=e.default,e=>F=e.default,e=>U=e.default,e=>Z=e.default,e=>(X=e.useQuery,$=e.useMutation),e=>(J=e.default,ee=e.useCurrency,ea=e.useIntlFormatter,et=e.useRtl,er=e.UnsafeLocalize,en=e.useLocalize),e=>ei=e.default,e=>es=e.default,e=>eo=e.default,e=>(el=e.RadioGroup,ed=e.RadioButton),e=>ec=e.TextArea,e=>eu=e.default,e=>eh=e.default,e=>em=e.default,e=>eg=e.Spinner,e=>ep=e.useViewportCategory,e=>ef=e.default,e=>eT=e.default,e=>ev=e.default,e=>eb=e.getQAAttributes,e=>eE=e.BubbleRating,e=>eI=e.default,e=>ey=e.default,e=>eC=e.default,e=>(eN=e.LatLng,e_=e.LatLngBounds,eS=e.Util),e=>(eM=e.useMarkerRegistryContext,eR=e.CollapsibleIconPinMarker,ek=e.MarkerRegistryContextProvider),e=>eP=e.MapComponent,e=>eA=e.debounce,e=>ew=e.default,e=>eO=e.default,e=>eL=e.CardMedia,e=>eD=e.default,e=>eB=e.IconDetail,e=>eQ=e.default,e=>(ez=e.default,ex=e.lineClamp,eW=e.padding),e=>eH=e.default,e=>eV=e.getPrimaryTag,e=>eK=e.default,e=>eq=e.default,e=>eG=e.default,e=>eY=e.useInvalidatableQuery,e=>ej=e.default,e=>eF=e.default,e=>eU=e.default,e=>eZ=e.default,e=>eX=e.default,e=>e$=e.Skeleton,e=>(eJ=e.Counter,e0=e.ErrorBoundary),e=>e1=e.useClientSideLayoutEffect,e=>e2=e.useIconSvgAttributes,e=>e4=e.default,e=>e3=e.useUserAgent,e=>e6=e.useGetServiceLink,e=>e9=e.default,e=>e7=e.FocusTrap,e=>e5=e.default,e=>(e8=e.useToday,ae=e.addDays),e=>aa=e.default]]},["21h32l","o4yt4q","1rki99","meqo19","rdycz1","52far5","kq4q2w","gcjubj","w43m8k","u47wjb","nntg4s","5vmpsm","22xnaq","jppfwt","essqvy","y9enps","lr6tb6","dpzonz","mqwhqn","7thqz4","n4zdla","wehxiu","qkjm8h","frf6ac","tv5det","fkji80","i0z8n1","4ilds0","qndsds","ys6v1o","633gr8","u3wokd","kt39pq","j77a03","trf9tg","0wbf8p","6h4i0r","us1vwl","jgmezl","49c7br","5xqg72","dsbyen","34bu7w","p9ucm8","f1x7n0","bp96i9","70j2tf","o3mm96","gw8uw6","p3y1zq","xfufl0","ph948p","a6i9w3","6qmqhw","fbuhsy","9zpurr","xp34yw","o80y56","dcz41w","covaqn","voa3hw","83pm0d","mb2nze","q213pt","h9085v","nnprhg","epp8eq","ypf49l","2r4qug","ti102j","kb5au4","d3i8k1"]]);
